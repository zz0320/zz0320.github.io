<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto+Serif+SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://unpkg.com/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://unpkg.com/pace-js@1.2.4/themes/silver/pace-theme-minimal.css">
  <script src="https://unpkg.com/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"username.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.11.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="三种数据集格式介绍COCO文件存放格式12345678910├── coco2017: 数据集根目录     ├── train2017: 所有训练图像文件夹(118287张)     ├── val2017: 所有验证图像文件夹(5000张)     └── annotations: 对应标注文件夹     		  ├── instances_train2017.json: 对应目标检测、分割任">
<meta property="og:type" content="article">
<meta property="og:title" content="「小脚本」（二）目标检测标注文件格式转化">
<meta property="og:url" content="https://username.github.io/2022/05/23/%E3%80%8C%E5%B0%8F%E8%84%9A%E6%9C%AC%E3%80%8D%EF%BC%88%E4%BA%8C%EF%BC%89%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%A0%87%E6%B3%A8%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%BD%AC%E5%8C%96/index.html">
<meta property="og:site_name" content="陨石kk的博客">
<meta property="og:description" content="三种数据集格式介绍COCO文件存放格式12345678910├── coco2017: 数据集根目录     ├── train2017: 所有训练图像文件夹(118287张)     ├── val2017: 所有验证图像文件夹(5000张)     └── annotations: 对应标注文件夹     		  ├── instances_train2017.json: 对应目标检测、分割任">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-05-23T07:25:27.000Z">
<meta property="article:modified_time" content="2022-05-31T11:36:28.348Z">
<meta property="article:author" content="陨石kk">
<meta property="article:tag" content="小脚本">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://username.github.io/2022/05/23/%E3%80%8C%E5%B0%8F%E8%84%9A%E6%9C%AC%E3%80%8D%EF%BC%88%E4%BA%8C%EF%BC%89%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%A0%87%E6%B3%A8%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%BD%AC%E5%8C%96/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://username.github.io/2022/05/23/%E3%80%8C%E5%B0%8F%E8%84%9A%E6%9C%AC%E3%80%8D%EF%BC%88%E4%BA%8C%EF%BC%89%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%A0%87%E6%B3%A8%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%BD%AC%E5%8C%96/","path":"2022/05/23/「小脚本」（二）目标检测标注文件格式转化/","title":"「小脚本」（二）目标检测标注文件格式转化"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>「小脚本」（二）目标检测标注文件格式转化 | 陨石kk的博客</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">陨石kk的博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-主页"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页</a></li><li class="menu-item menu-item-标签"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-归档"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-关于"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E7%A7%8D%E6%95%B0%E6%8D%AE%E9%9B%86%E6%A0%BC%E5%BC%8F%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.</span> <span class="nav-text">三种数据集格式介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#COCO"><span class="nav-number">1.1.</span> <span class="nav-text">COCO</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%AD%98%E6%94%BE%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.1.1.</span> <span class="nav-text">文件存放格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E6%A0%BC%E5%BC%8F%E3%80%8C%E5%AE%98%E6%96%B9%E8%AF%B4%E6%98%8E%E3%80%8D"><span class="nav-number">1.1.2.</span> <span class="nav-text">标签格式「官方说明」</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#VOC"><span class="nav-number">1.2.</span> <span class="nav-text">VOC</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%AD%98%E6%94%BE%E6%A0%BC%E5%BC%8F-1"><span class="nav-number">1.2.1.</span> <span class="nav-text">文件存放格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E6%A0%BC%E5%BC%8F"><span class="nav-number">1.2.2.</span> <span class="nav-text">标签格式</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#YOLO%E3%80%8C%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5%E3%80%8D"><span class="nav-number">1.3.</span> <span class="nav-text">YOLO「参考链接」</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E5%AD%98%E6%94%BE%E6%A0%BC%E5%BC%8F-2"><span class="nav-number">1.3.1.</span> <span class="nav-text">文件存放格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A0%87%E7%AD%BE%E6%A0%BC%E5%BC%8F-1"><span class="nav-number">1.3.2.</span> <span class="nav-text">标签格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#yaml%E6%96%87%E4%BB%B6%E5%86%99%E6%B3%95"><span class="nav-number">1.3.3.</span> <span class="nav-text">yaml文件写法</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AC%E6%8D%A2%E7%A8%8B%E5%BA%8F"><span class="nav-number">2.</span> <span class="nav-text">转换程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#coco2voc-py"><span class="nav-number">2.1.</span> <span class="nav-text">coco2voc.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#voc2coco-py"><span class="nav-number">2.2.</span> <span class="nav-text">voc2coco.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#coco2yolo-py%E3%80%8CU%E7%A5%9EGitHub%E9%93%BE%E6%8E%A5%E3%80%8D"><span class="nav-number">2.3.</span> <span class="nav-text">coco2yolo.py「U神GitHub链接」</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#yolo2coco-py%E3%80%8CRapidAI%E5%A4%A7%E7%A5%9EGitHub%E3%80%8D"><span class="nav-number">2.4.</span> <span class="nav-text">yolo2coco.py「RapidAI大神GitHub」</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#voc2yolo-py"><span class="nav-number">2.5.</span> <span class="nav-text">voc2yolo.py</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%BE%E7%BD%AE%E4%BD%8D%E7%BD%AE"><span class="nav-number">2.5.1.</span> <span class="nav-text">放置位置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">2.5.2.</span> <span class="nav-text">代码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#yolo2voc-py"><span class="nav-number">2.6.</span> <span class="nav-text">yolo2voc.py</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="陨石kk"
      src="/uploads/%E5%A4%B4%E5%83%8F.jpg">
  <p class="site-author-name" itemprop="name">陨石kk</p>
  <div class="site-description" itemprop="description">无限进步</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">29</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zz0320" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zz0320" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zyc160378629@gmail.com" title="E-Mail → mailto:zyc160378629@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://username.github.io/2022/05/23/%E3%80%8C%E5%B0%8F%E8%84%9A%E6%9C%AC%E3%80%8D%EF%BC%88%E4%BA%8C%EF%BC%89%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%A0%87%E6%B3%A8%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E8%BD%AC%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/%E5%A4%B4%E5%83%8F.jpg">
      <meta itemprop="name" content="陨石kk">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="陨石kk的博客">
      <meta itemprop="description" content="无限进步">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="「小脚本」（二）目标检测标注文件格式转化 | 陨石kk的博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          「小脚本」（二）目标检测标注文件格式转化
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
  
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2022-05-23 15:25:27" itemprop="dateCreated datePublished" datetime="2022-05-23T15:25:27+08:00">2022-05-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-31 19:36:28" itemprop="dateModified" datetime="2022-05-31T19:36:28+08:00">2022-05-31</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h2 id="三种数据集格式介绍"><a href="#三种数据集格式介绍" class="headerlink" title="三种数据集格式介绍"></a>三种数据集格式介绍</h2><h3 id="COCO"><a href="#COCO" class="headerlink" title="COCO"></a>COCO</h3><h4 id="文件存放格式"><a href="#文件存放格式" class="headerlink" title="文件存放格式"></a>文件存放格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">├── coco2017: 数据集根目录</span><br><span class="line">     ├── train2017: 所有训练图像文件夹(118287张)</span><br><span class="line">     ├── val2017: 所有验证图像文件夹(5000张)</span><br><span class="line">     └── annotations: 对应标注文件夹</span><br><span class="line">     		  ├── instances_train2017.json: 对应目标检测、分割任务的训练集标注文件</span><br><span class="line">     		  ├── instances_val2017.json: 对应目标检测、分割任务的验证集标注文件</span><br><span class="line">     		  ├── captions_train2017.json: 对应图像描述的训练集标注文件</span><br><span class="line">     		  ├── captions_val2017.json: 对应图像描述的验证集标注文件</span><br><span class="line">     		  ├── person_keypoints_train2017.json: 对应人体关键点检测的训练集标注文件</span><br><span class="line">     		  └── person_keypoints_val2017.json: 对应人体关键点检测的验证集标注文件夹</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h4 id="标签格式「官方说明」"><a href="#标签格式「官方说明」" class="headerlink" title="标签格式「官方说明」"></a>标签格式「<a target="_blank" rel="noopener" href="https://cocodataset.org/#format-data">官方说明</a>」</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">	<span class="attr">"info"</span><span class="punctuation">:</span> info<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"images"</span><span class="punctuation">:</span> <span class="punctuation">[</span>image<span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"annotations"</span><span class="punctuation">:</span> <span class="punctuation">[</span>annotation<span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"licenses"</span><span class="punctuation">:</span> <span class="punctuation">[</span>license<span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">info<span class="punctuation">{</span></span><br><span class="line">	<span class="attr">"year"</span><span class="punctuation">:</span> int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"version"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"description"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"contributor"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"url"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"date_created"</span><span class="punctuation">:</span> datetime<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">image<span class="punctuation">{</span></span><br><span class="line">	<span class="attr">"id"</span><span class="punctuation">:</span> int<span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"width"</span><span class="punctuation">:</span> int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"height"</span><span class="punctuation">:</span> int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"file_name"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"license"</span><span class="punctuation">:</span> int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"flickr_url"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"coco_url"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"date_captured"</span><span class="punctuation">:</span> datetime<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">license<span class="punctuation">{</span></span><br><span class="line">	<span class="attr">"id"</span><span class="punctuation">:</span> int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"url"</span><span class="punctuation">:</span> str<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">annotation<span class="punctuation">{</span></span><br><span class="line">	<span class="attr">"id"</span><span class="punctuation">:</span> 				int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"image_id"</span><span class="punctuation">:</span> 	int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"category_id"</span><span class="punctuation">:</span> int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"segmentation"</span><span class="punctuation">:</span> RLE or <span class="punctuation">[</span>polygon<span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">	<span class="attr">"area"</span><span class="punctuation">:</span> 			float<span class="punctuation">,</span> </span><br><span class="line">	<span class="attr">"bbox"</span><span class="punctuation">:</span>				<span class="punctuation">[</span>x<span class="punctuation">,</span>y<span class="punctuation">,</span>width<span class="punctuation">,</span>height<span class="punctuation">]</span><span class="punctuation">,</span> </span><br><span class="line">	<span class="attr">"iscrowd"</span><span class="punctuation">:</span>		<span class="number">0</span> or <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">}</span></span><br><span class="line"></span><br><span class="line">categories<span class="punctuation">[</span><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"id"</span><span class="punctuation">:</span> int<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"name"</span><span class="punctuation">:</span> str<span class="punctuation">,</span> </span><br><span class="line">  <span class="attr">"supercategory"</span><span class="punctuation">:</span> str<span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">}</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h3 id="VOC"><a href="#VOC" class="headerlink" title="VOC"></a>VOC</h3><h4 id="文件存放格式-1"><a href="#文件存放格式-1" class="headerlink" title="文件存放格式"></a>文件存放格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">#第一级</span><br><span class="line">VOCdevkit</span><br><span class="line">├── VOC2007</span><br><span class="line">└── VOC2012</span><br><span class="line">#第二级</span><br><span class="line">VOCdevkit/VOC2007</span><br><span class="line">├── Annotations</span><br><span class="line">├── ImageSets</span><br><span class="line">├── JPEGImages</span><br><span class="line"></span><br><span class="line">VOCdevkit/VOC2012</span><br><span class="line">├── Annotations</span><br><span class="line">├── ImageSets</span><br><span class="line">├── JPEGImages</span><br><span class="line"></span><br><span class="line">#以VOC2007为例，第三级</span><br><span class="line">## Annotations</span><br><span class="line">VOCdevkit/VOC2007/Annotations/</span><br><span class="line">├── 000001.xml</span><br><span class="line">...</span><br><span class="line">## JPEGImages</span><br><span class="line">VOCdevkit/VOC2007/JPEGImages/</span><br><span class="line">├── 000001.jpg</span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="标签格式"><a href="#标签格式" class="headerlink" title="标签格式"></a>标签格式</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">annotation</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">folder</span>&gt;</span>油罐车图片<span class="tag">&lt;/<span class="name">folder</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">filename</span>&gt;</span>1.jpg<span class="tag">&lt;/<span class="name">filename</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">path</span>&gt;</span>D:\Desktop\油罐车图片\1.jpg<span class="tag">&lt;/<span class="name">path</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">source</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">database</span>&gt;</span>Unknown<span class="tag">&lt;/<span class="name">database</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">size</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">width</span>&gt;</span>312<span class="tag">&lt;/<span class="name">width</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">height</span>&gt;</span>208<span class="tag">&lt;/<span class="name">height</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">depth</span>&gt;</span>3<span class="tag">&lt;/<span class="name">depth</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">size</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">segmented</span>&gt;</span>0<span class="tag">&lt;/<span class="name">segmented</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>redCap<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pose</span>&gt;</span>Unspecified<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmin</span>&gt;</span>43<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymin</span>&gt;</span>92<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmax</span>&gt;</span>96<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymax</span>&gt;</span>144<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>yellowCap<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pose</span>&gt;</span>Unspecified<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmin</span>&gt;</span>147<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymin</span>&gt;</span>98<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmax</span>&gt;</span>198<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymax</span>&gt;</span>151<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">object</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">name</span>&gt;</span>oilTruck<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">pose</span>&gt;</span>Unspecified<span class="tag">&lt;/<span class="name">pose</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">truncated</span>&gt;</span>0<span class="tag">&lt;/<span class="name">truncated</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">difficult</span>&gt;</span>0<span class="tag">&lt;/<span class="name">difficult</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">bndbox</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmin</span>&gt;</span>111<span class="tag">&lt;/<span class="name">xmin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymin</span>&gt;</span>46<span class="tag">&lt;/<span class="name">ymin</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">xmax</span>&gt;</span>266<span class="tag">&lt;/<span class="name">xmax</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">ymax</span>&gt;</span>157<span class="tag">&lt;/<span class="name">ymax</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">bndbox</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">object</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">annotation</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="YOLO「参考链接」"><a href="#YOLO「参考链接」" class="headerlink" title="YOLO「参考链接」"></a>YOLO「<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_36756866/article/details/109111065">参考链接</a>」</h3><h4 id="文件存放格式-2"><a href="#文件存放格式-2" class="headerlink" title="文件存放格式"></a>文件存放格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">├── dataset: 数据集根目录</span><br><span class="line">     └── images: 所有训练图像文件夹</span><br><span class="line">     		  └── train2017: 对应人体关键点检测的验证集标注文件夹</span><br><span class="line">     └── labels: 对应标注文件夹</span><br><span class="line">     		  └── train2017: 对应人体关键点检测的验证集标注文件夹</span><br><span class="line">     └── train.txt: 所有训练图像路径集合，其中某行：'/root/VOC2012/images/000003.jpg'</span><br><span class="line">     └── val.txt: 所有验证图像路径集合，同上</span><br><span class="line">     └── test.txt: 所有测试图像路径集合，同上</span><br></pre></td></tr></table></figure>

<h4 id="标签格式-1"><a href="#标签格式-1" class="headerlink" title="标签格式"></a>标签格式</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;object-class&gt; &lt;x&gt; &lt;y&gt; &lt;width&gt; &lt;height&gt;</span><br><span class="line">例子：</span><br><span class="line">0 0.412500 0.318981 0.358333 0.636111</span><br></pre></td></tr></table></figure>

<h4 id="yaml文件写法"><a href="#yaml文件写法" class="headerlink" title="yaml文件写法"></a>yaml文件写法</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># train and val data as 1) directory: path/images/, 2) file: path/images.txt, or 3) list: [path1/images/, path2/images/]</span></span><br><span class="line"><span class="attr">train:</span> <span class="string">../dataset/train.txt</span> <span class="comment">#  训练集</span></span><br><span class="line"><span class="attr">val:</span> <span class="string">../dataset/val.txt</span> <span class="comment"># 验证集</span></span><br><span class="line"><span class="attr">test:</span> <span class="string">../dataset/test.txt</span> <span class="comment"># 测试集</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># number of classes 类别数</span></span><br><span class="line"><span class="attr">nc:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># class names 类别列表</span></span><br><span class="line"><span class="attr">names:</span> [<span class="string">'person'</span>, <span class="string">'bicycle'</span>, <span class="string">'car'</span>, <span class="string">'motorcycle'</span>, <span class="string">'airplane'</span>, <span class="string">'bus'</span>, <span class="string">'train'</span>, <span class="string">'truck'</span>, <span class="string">'boat'</span>, <span class="string">'traffic light'</span>,</span><br><span class="line">        <span class="string">'fire hydrant'</span>, <span class="string">'stop sign'</span>, <span class="string">'parking meter'</span>, <span class="string">'bench'</span>, <span class="string">'bird'</span>, <span class="string">'cat'</span>, <span class="string">'dog'</span>, <span class="string">'horse'</span>, <span class="string">'sheep'</span>, <span class="string">'cow'</span>,</span><br><span class="line">        <span class="string">'elephant'</span>, <span class="string">'bear'</span>, <span class="string">'zebra'</span>, <span class="string">'giraffe'</span>, <span class="string">'backpack'</span>, <span class="string">'umbrella'</span>, <span class="string">'handbag'</span>, <span class="string">'tie'</span>, <span class="string">'suitcase'</span>, <span class="string">'frisbee'</span>,</span><br><span class="line">        <span class="string">'skis'</span>, <span class="string">'snowboard'</span>, <span class="string">'sports ball'</span>, <span class="string">'kite'</span>, <span class="string">'baseball bat'</span>, <span class="string">'baseball glove'</span>, <span class="string">'skateboard'</span>, <span class="string">'surfboard'</span>,</span><br><span class="line">        <span class="string">'tennis racket'</span>, <span class="string">'bottle'</span>, <span class="string">'wine glass'</span>, <span class="string">'cup'</span>, <span class="string">'fork'</span>, <span class="string">'knife'</span>, <span class="string">'spoon'</span>, <span class="string">'bowl'</span>, <span class="string">'banana'</span>, <span class="string">'apple'</span>,</span><br><span class="line">        <span class="string">'sandwich'</span>, <span class="string">'orange'</span>, <span class="string">'broccoli'</span>, <span class="string">'carrot'</span>, <span class="string">'hot dog'</span>, <span class="string">'pizza'</span>, <span class="string">'donut'</span>, <span class="string">'cake'</span>, <span class="string">'chair'</span>, <span class="string">'couch'</span>,</span><br><span class="line">        <span class="string">'potted plant'</span>, <span class="string">'bed'</span>, <span class="string">'dining table'</span>, <span class="string">'toilet'</span>, <span class="string">'tv'</span>, <span class="string">'laptop'</span>, <span class="string">'mouse'</span>, <span class="string">'remote'</span>, <span class="string">'keyboard'</span>, <span class="string">'cell phone'</span>,</span><br><span class="line">        <span class="string">'microwave'</span>, <span class="string">'oven'</span>, <span class="string">'toaster'</span>, <span class="string">'sink'</span>, <span class="string">'refrigerator'</span>, <span class="string">'book'</span>, <span class="string">'clock'</span>, <span class="string">'vase'</span>, <span class="string">'scissors'</span>, <span class="string">'teddy bear'</span>,</span><br><span class="line">        <span class="string">'hair drier'</span>, <span class="string">'toothbrush'</span>]</span><br></pre></td></tr></table></figure>

<h2 id="转换程序"><a href="#转换程序" class="headerlink" title="转换程序"></a>转换程序</h2><h3 id="coco2voc-py"><a href="#coco2voc-py" class="headerlink" title="coco2voc.py"></a>coco2voc.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 之前安装好pycoco-tools</span></span><br><span class="line"><span class="keyword">from</span> pycocotools.coco <span class="keyword">import</span> COCO</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> skimage.io <span class="keyword">as</span> io</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image, ImageDraw</span><br><span class="line"> </span><br><span class="line"><span class="comment">#the path you want to save your results for coco to voc</span></span><br><span class="line">savepath=<span class="string">"E:/datasets/COCO/result/"</span></span><br><span class="line">img_dir=savepath+<span class="string">'images/'</span></span><br><span class="line">anno_dir=savepath+<span class="string">'Annotations/'</span></span><br><span class="line"><span class="comment"># datasets_list=['train2014', 'val2014']</span></span><br><span class="line">datasets_list=[<span class="string">'train2017'</span>]</span><br><span class="line"> </span><br><span class="line">classes_names = [<span class="string">'car'</span>, <span class="string">'bicycle'</span>, <span class="string">'person'</span>, <span class="string">'motorcycle'</span>, <span class="string">'bus'</span>, <span class="string">'truck'</span>]</span><br><span class="line"><span class="comment">#Store annotations and train2014/val2014/... in this folder</span></span><br><span class="line">dataDir= <span class="string">'E:/datasets/COCO/'</span></span><br><span class="line"> </span><br><span class="line">headstr = <span class="string">"""\</span></span><br><span class="line"><span class="string">&lt;annotation&gt;</span></span><br><span class="line"><span class="string">    &lt;folder&gt;VOC&lt;/folder&gt;</span></span><br><span class="line"><span class="string">    &lt;filename&gt;%s&lt;/filename&gt;</span></span><br><span class="line"><span class="string">    &lt;source&gt;</span></span><br><span class="line"><span class="string">        &lt;database&gt;My Database&lt;/database&gt;</span></span><br><span class="line"><span class="string">        &lt;annotation&gt;COCO&lt;/annotation&gt;</span></span><br><span class="line"><span class="string">        &lt;image&gt;flickr&lt;/image&gt;</span></span><br><span class="line"><span class="string">        &lt;flickrid&gt;NULL&lt;/flickrid&gt;</span></span><br><span class="line"><span class="string">    &lt;/source&gt;</span></span><br><span class="line"><span class="string">    &lt;owner&gt;</span></span><br><span class="line"><span class="string">        &lt;flickrid&gt;NULL&lt;/flickrid&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;company&lt;/name&gt;</span></span><br><span class="line"><span class="string">    &lt;/owner&gt;</span></span><br><span class="line"><span class="string">    &lt;size&gt;</span></span><br><span class="line"><span class="string">        &lt;width&gt;%d&lt;/width&gt;</span></span><br><span class="line"><span class="string">        &lt;height&gt;%d&lt;/height&gt;</span></span><br><span class="line"><span class="string">        &lt;depth&gt;%d&lt;/depth&gt;</span></span><br><span class="line"><span class="string">    &lt;/size&gt;</span></span><br><span class="line"><span class="string">    &lt;segmented&gt;0&lt;/segmented&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">objstr = <span class="string">"""\</span></span><br><span class="line"><span class="string">    &lt;object&gt;</span></span><br><span class="line"><span class="string">        &lt;name&gt;%s&lt;/name&gt;</span></span><br><span class="line"><span class="string">        &lt;pose&gt;Unspecified&lt;/pose&gt;</span></span><br><span class="line"><span class="string">        &lt;truncated&gt;0&lt;/truncated&gt;</span></span><br><span class="line"><span class="string">        &lt;difficult&gt;0&lt;/difficult&gt;</span></span><br><span class="line"><span class="string">        &lt;bndbox&gt;</span></span><br><span class="line"><span class="string">            &lt;xmin&gt;%d&lt;/xmin&gt;</span></span><br><span class="line"><span class="string">            &lt;ymin&gt;%d&lt;/ymin&gt;</span></span><br><span class="line"><span class="string">            &lt;xmax&gt;%d&lt;/xmax&gt;</span></span><br><span class="line"><span class="string">            &lt;ymax&gt;%d&lt;/ymax&gt;</span></span><br><span class="line"><span class="string">        &lt;/bndbox&gt;</span></span><br><span class="line"><span class="string">    &lt;/object&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"> </span><br><span class="line">tailstr = <span class="string">'''\</span></span><br><span class="line"><span class="string">&lt;/annotation&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#if the dir is not exists,make it,else delete it</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mkr</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">if</span> os.path.exists(path):</span><br><span class="line">        shutil.rmtree(path)</span><br><span class="line">        os.mkdir(path)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        os.mkdir(path)</span><br><span class="line">mkr(img_dir)</span><br><span class="line">mkr(anno_dir)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">id2name</span>(<span class="params">coco</span>):</span><br><span class="line">    classes=<span class="built_in">dict</span>()</span><br><span class="line">    <span class="keyword">for</span> cls <span class="keyword">in</span> coco.dataset[<span class="string">'categories'</span>]:</span><br><span class="line">        classes[cls[<span class="string">'id'</span>]]=cls[<span class="string">'name'</span>]</span><br><span class="line">    <span class="keyword">return</span> classes</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">write_xml</span>(<span class="params">anno_path,head, objs, tail</span>):</span><br><span class="line">    f = <span class="built_in">open</span>(anno_path, <span class="string">"w"</span>)</span><br><span class="line">    f.write(head)</span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> objs:</span><br><span class="line">        f.write(objstr%(obj[<span class="number">0</span>],obj[<span class="number">1</span>],obj[<span class="number">2</span>],obj[<span class="number">3</span>],obj[<span class="number">4</span>]))</span><br><span class="line">    f.write(tail)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_annotations_and_imgs</span>(<span class="params">coco,dataset,filename,objs</span>):</span><br><span class="line">    <span class="comment">#eg:COCO_train2014_000000196610.jpg--&gt;COCO_train2014_000000196610.xml</span></span><br><span class="line">    anno_path=anno_dir+filename[:-<span class="number">3</span>]+<span class="string">'xml'</span></span><br><span class="line">    img_path=dataDir+dataset+<span class="string">'/'</span>+filename</span><br><span class="line">    <span class="built_in">print</span>(img_path)</span><br><span class="line">    dst_imgpath=img_dir+filename</span><br><span class="line"> </span><br><span class="line">    img=cv2.imread(img_path)</span><br><span class="line">    <span class="keyword">if</span> (img.shape[<span class="number">2</span>] == <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(filename + <span class="string">" not a RGB image"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    shutil.copy(img_path, dst_imgpath)</span><br><span class="line"> </span><br><span class="line">    head=headstr % (filename, img.shape[<span class="number">1</span>], img.shape[<span class="number">0</span>], img.shape[<span class="number">2</span>])</span><br><span class="line">    tail = tailstr</span><br><span class="line">    write_xml(anno_path,head, objs, tail)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showimg</span>(<span class="params">coco,dataset,img,classes,cls_id,show=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="keyword">global</span> dataDir</span><br><span class="line">    I=Image.<span class="built_in">open</span>(<span class="string">'%s/%s/%s'</span>%(dataDir,dataset,img[<span class="string">'file_name'</span>]))</span><br><span class="line">    <span class="comment">#通过id，得到注释的信息</span></span><br><span class="line">    annIds = coco.getAnnIds(imgIds=img[<span class="string">'id'</span>], catIds=cls_id, iscrowd=<span class="literal">None</span>)</span><br><span class="line">    <span class="comment"># print(annIds)</span></span><br><span class="line">    anns = coco.loadAnns(annIds)</span><br><span class="line">    <span class="comment"># print(anns)</span></span><br><span class="line">    <span class="comment"># coco.showAnns(anns)</span></span><br><span class="line">    objs = []</span><br><span class="line">    <span class="keyword">for</span> ann <span class="keyword">in</span> anns:</span><br><span class="line">        class_name=classes[ann[<span class="string">'category_id'</span>]]</span><br><span class="line">        <span class="keyword">if</span> class_name <span class="keyword">in</span> classes_names:</span><br><span class="line">            <span class="built_in">print</span>(class_name)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">'bbox'</span> <span class="keyword">in</span> ann:</span><br><span class="line">                bbox=ann[<span class="string">'bbox'</span>]</span><br><span class="line">                xmin = <span class="built_in">int</span>(bbox[<span class="number">0</span>])</span><br><span class="line">                ymin = <span class="built_in">int</span>(bbox[<span class="number">1</span>])</span><br><span class="line">                xmax = <span class="built_in">int</span>(bbox[<span class="number">2</span>] + bbox[<span class="number">0</span>])</span><br><span class="line">                ymax = <span class="built_in">int</span>(bbox[<span class="number">3</span>] + bbox[<span class="number">1</span>])</span><br><span class="line">                obj = [class_name, xmin, ymin, xmax, ymax]</span><br><span class="line">                objs.append(obj)</span><br><span class="line">                draw = ImageDraw.Draw(I)</span><br><span class="line">                draw.rectangle([xmin, ymin, xmax, ymax])</span><br><span class="line">    <span class="keyword">if</span> show:</span><br><span class="line">        plt.figure()</span><br><span class="line">        plt.axis(<span class="string">'off'</span>)</span><br><span class="line">        plt.imshow(I)</span><br><span class="line">        plt.show()</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> objs</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> dataset <span class="keyword">in</span> datasets_list:</span><br><span class="line">    <span class="comment">#./COCO/annotations/instances_train2014.json</span></span><br><span class="line">    annFile=<span class="string">'{}/annotations/instances_{}.json'</span>.<span class="built_in">format</span>(dataDir,dataset)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">#COCO API for initializing annotated data</span></span><br><span class="line">    coco = COCO(annFile)</span><br><span class="line">    <span class="string">'''</span></span><br><span class="line"><span class="string">    COCO 对象创建完毕后会输出如下信息:</span></span><br><span class="line"><span class="string">    loading annotations into memory...</span></span><br><span class="line"><span class="string">    Done (t=0.81s)</span></span><br><span class="line"><span class="string">    creating index...</span></span><br><span class="line"><span class="string">    index created!</span></span><br><span class="line"><span class="string">    至此, json 脚本解析完毕, 并且将图片和对应的标注数据关联起来.</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="comment">#show all classes in coco</span></span><br><span class="line">    classes = id2name(coco)</span><br><span class="line">    <span class="built_in">print</span>(classes)</span><br><span class="line">    <span class="comment">#[1, 2, 3, 4, 6, 8]</span></span><br><span class="line">    classes_ids = coco.getCatIds(catNms=classes_names)</span><br><span class="line">    <span class="built_in">print</span>(classes_ids)</span><br><span class="line">    <span class="keyword">for</span> cls <span class="keyword">in</span> classes_names:</span><br><span class="line">        <span class="comment">#Get ID number of this class</span></span><br><span class="line">        cls_id=coco.getCatIds(catNms=[cls])</span><br><span class="line">        img_ids=coco.getImgIds(catIds=cls_id)</span><br><span class="line">        <span class="built_in">print</span>(cls,<span class="built_in">len</span>(img_ids))</span><br><span class="line">        <span class="comment"># imgIds=img_ids[0:10]</span></span><br><span class="line">        <span class="keyword">for</span> imgId <span class="keyword">in</span> tqdm(img_ids):</span><br><span class="line">            img = coco.loadImgs(imgId)[<span class="number">0</span>]</span><br><span class="line">            filename = img[<span class="string">'file_name'</span>]</span><br><span class="line">            <span class="comment"># print(filename)</span></span><br><span class="line">            objs=showimg(coco, dataset, img, classes,classes_ids,show=<span class="literal">False</span>)</span><br><span class="line">            <span class="built_in">print</span>(objs)</span><br><span class="line">            save_annotations_and_imgs(coco, dataset, filename, objs)</span><br></pre></td></tr></table></figure>

<h3 id="voc2coco-py"><a href="#voc2coco-py" class="headerlink" title="voc2coco.py"></a>voc2coco.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:UTF-8 -*-</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string"># @file name  : voc2coco.py</span></span><br><span class="line"><span class="string"># @author     : zz0320</span></span><br><span class="line"><span class="string"># @brief      : voc格式转成coco &amp; 数据集划分</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">You only need to set the following three parts</span></span><br><span class="line"><span class="string">1.val_files_num : num of validation samples from your all samples</span></span><br><span class="line"><span class="string">2.test_files_num = num of test samples from your all samples</span></span><br><span class="line"><span class="string">3.voc_annotations : path to your VOC dataset Annotations</span></span><br><span class="line"><span class="string"> </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">val_files_num = <span class="number">500</span></span><br><span class="line">test_files_num = <span class="number">200</span></span><br><span class="line">voc_annotations = <span class="string">'/Users/kenton/Downloads/集群重点研发/蝠鲼数据集/jpg/处理结果集合/VOCdevkit/VOC2007/Annotations/'</span></span><br><span class="line"><span class="comment">#voc数据集annotations的地址</span></span><br><span class="line"></span><br><span class="line">split = voc_annotations.split(<span class="string">'/'</span>)</span><br><span class="line">coco_name = split[-<span class="number">3</span>]</span><br><span class="line"><span class="keyword">del</span> split[-<span class="number">3</span>]</span><br><span class="line"><span class="keyword">del</span> split[-<span class="number">2</span>]</span><br><span class="line"><span class="keyword">del</span> split[-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">del</span> split[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># print(split)</span></span><br><span class="line">main_path = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> split:</span><br><span class="line">    main_path += <span class="string">'/'</span> + i</span><br><span class="line"></span><br><span class="line">main_path = main_path + <span class="string">'/'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(main_path)</span></span><br><span class="line"></span><br><span class="line">coco_path = os.path.join(main_path, coco_name+<span class="string">'_COCO/'</span>)</span><br><span class="line">coco_images = os.path.join(main_path, coco_name+<span class="string">'_COCO/images'</span>)</span><br><span class="line">coco_json_annotations = os.path.join(main_path, coco_name+<span class="string">'_COCO/annotations/'</span>)</span><br><span class="line">xml_val = os.path.join(main_path, <span class="string">'xml'</span>, <span class="string">'xml_val/'</span>)</span><br><span class="line">xml_test = os.path.join(main_path, <span class="string">'xml/'</span>, <span class="string">'xml_test/'</span>)</span><br><span class="line">xml_train = os.path.join(main_path, <span class="string">'xml/'</span>, <span class="string">'xml_train/'</span>)</span><br><span class="line"></span><br><span class="line">voc_images = os.path.join(main_path, coco_name, <span class="string">'JPEGImages/'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mkdir</span>(<span class="params">path</span>):</span><br><span class="line">    path=path.strip()</span><br><span class="line">    path=path.rstrip(<span class="string">"\\"</span>)</span><br><span class="line">    isExists=os.path.exists(path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isExists:</span><br><span class="line">        os.makedirs(path)</span><br><span class="line">        <span class="built_in">print</span>(path+<span class="string">' ----- folder created'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(path+<span class="string">' ----- folder existed'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">mkdir(coco_path)</span><br><span class="line">mkdir(coco_images)</span><br><span class="line">mkdir(coco_json_annotations)</span><br><span class="line">mkdir(xml_val)</span><br><span class="line">mkdir(xml_test)</span><br><span class="line">mkdir(xml_train)</span><br><span class="line"></span><br><span class="line"><span class="comment">#voc images copy to coco images</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(voc_images):</span><br><span class="line">    img_path = os.path.join(voc_images + i)</span><br><span class="line">    shutil.copy(img_path, coco_images)</span><br><span class="line">    <span class="comment"># voc images copy to coco images</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> os.listdir(voc_annotations):</span><br><span class="line">    img_path = os.path.join(voc_annotations + i)</span><br><span class="line">    shutil.copy(img_path, xml_train)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n\n %s files copied to %s"</span> % (val_files_num, xml_val))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(val_files_num):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(os.listdir(xml_train)) &gt; <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">        random_file = random.choice(os.listdir(xml_train))</span><br><span class="line">        <span class="comment">#         print("%d) %s"%(i+1,random_file))</span></span><br><span class="line">        source_file = <span class="string">"%s/%s"</span> % (xml_train, random_file)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> random_file <span class="keyword">not</span> <span class="keyword">in</span> os.listdir(xml_val):</span><br><span class="line">            shutil.move(source_file, xml_val)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            random_file = random.choice(os.listdir(xml_train))</span><br><span class="line">            source_file = <span class="string">"%s/%s"</span> % (xml_train, random_file)</span><br><span class="line">            shutil.move(source_file, xml_val)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'The folders are empty, please make sure there are enough %d file to move'</span> % (val_files_num))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(test_files_num):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(os.listdir(xml_train)) &gt; <span class="number">0</span>:</span><br><span class="line"></span><br><span class="line">        random_file = random.choice(os.listdir(xml_train))</span><br><span class="line">        <span class="comment">#         print("%d) %s"%(i+1,random_file))</span></span><br><span class="line">        source_file = <span class="string">"%s/%s"</span> % (xml_train, random_file)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> random_file <span class="keyword">not</span> <span class="keyword">in</span> os.listdir(xml_test):</span><br><span class="line">            shutil.move(source_file, xml_test)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            random_file = random.choice(os.listdir(xml_train))</span><br><span class="line">            source_file = <span class="string">"%s/%s"</span> % (xml_train, random_file)</span><br><span class="line">            shutil.move(source_file, xml_test)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'The folders are empty, please make sure there are enough %d file to move'</span> % (val_files_num))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">"\n\n"</span> + <span class="string">"*"</span> * <span class="number">27</span> + <span class="string">"[ Done ! Go check your file ]"</span> + <span class="string">"*"</span> * <span class="number">28</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># !/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pip install lxml</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">START_BOUNDING_BOX_ID = <span class="number">1</span></span><br><span class="line"><span class="comment"># PRE_DEFINE_CATEGORIES = None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># If necessary, pre-define category and its id</span></span><br><span class="line">PRE_DEFINE_CATEGORIES = {<span class="string">"left_front"</span>: <span class="number">0</span>, <span class="string">"left_rear"</span>: <span class="number">1</span>, <span class="string">"right_front"</span>: <span class="number">2</span>, <span class="string">"right_rear"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">"front"</span>: <span class="number">4</span>, <span class="string">"rear"</span>: <span class="number">5</span>, <span class="string">"left"</span>: <span class="number">6</span>, <span class="string">"right"</span>: <span class="number">7</span>}</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">main code below are from</span></span><br><span class="line"><span class="string">https://github.com/Tony607/voc2coco</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get</span>(<span class="params">root, name</span>):</span><br><span class="line">    <span class="built_in">vars</span> = root.findall(name)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">vars</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_and_check</span>(<span class="params">root, name, length</span>):</span><br><span class="line">    <span class="built_in">vars</span> = root.findall(name)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(<span class="built_in">vars</span>) == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"Can not find %s in %s."</span> % (name, root.tag))</span><br><span class="line">    <span class="keyword">if</span> length &gt; <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(<span class="built_in">vars</span>) != length:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(</span><br><span class="line">            <span class="string">"The size of %s is supposed to be %d, but is %d."</span></span><br><span class="line">            % (name, length, <span class="built_in">len</span>(<span class="built_in">vars</span>))</span><br><span class="line">        )</span><br><span class="line">    <span class="keyword">if</span> length == <span class="number">1</span>:</span><br><span class="line">        <span class="built_in">vars</span> = <span class="built_in">vars</span>[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">vars</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_filename_as_int</span>(<span class="params">filename</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        filename = filename.replace(<span class="string">"\\"</span>, <span class="string">"/"</span>)</span><br><span class="line">        filename = os.path.splitext(os.path.basename(filename))[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(filename)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">"Filename %s is supposed to be an integer."</span> % (filename))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_categories</span>(<span class="params">xml_files</span>):</span><br><span class="line">    <span class="string">"""Generate category name to id mapping from a list of xml files.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Arguments:</span></span><br><span class="line"><span class="string">        xml_files {list} -- A list of xml file paths.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">        dict -- category name to id mapping.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    classes_names = []</span><br><span class="line">    <span class="keyword">for</span> xml_file <span class="keyword">in</span> xml_files:</span><br><span class="line">        file = <span class="built_in">open</span>(xml_file).read()</span><br><span class="line">        file = file.replace(<span class="string">"&amp;amp;"</span>, <span class="string">"_"</span>)</span><br><span class="line">        file = file.replace(<span class="string">"&amp;"</span>, <span class="string">"_"</span>)</span><br><span class="line">        <span class="comment"># print(file)</span></span><br><span class="line">        tree = ET.ElementTree(ET.fromstring(file))</span><br><span class="line">        root = tree.getroot()  <span class="comment"># 获取根节点</span></span><br><span class="line">        <span class="comment"># tree = ET.parse(xml_file)</span></span><br><span class="line">        <span class="comment"># root = tree.getroot()</span></span><br><span class="line">        <span class="keyword">for</span> member <span class="keyword">in</span> root.findall(<span class="string">"object"</span>):</span><br><span class="line">            classes_names.append(member[<span class="number">0</span>].text)</span><br><span class="line">    classes_names = <span class="built_in">list</span>(<span class="built_in">set</span>(classes_names))</span><br><span class="line">    classes_names.sort()</span><br><span class="line">    <span class="keyword">return</span> {name: i <span class="keyword">for</span> i, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(classes_names)}</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert</span>(<span class="params">xml_files, json_file</span>):</span><br><span class="line">    json_dict = {<span class="string">"images"</span>: [], <span class="string">"type"</span>: <span class="string">"instances"</span>, <span class="string">"annotations"</span>: [], <span class="string">"categories"</span>: []}</span><br><span class="line">    <span class="keyword">if</span> PRE_DEFINE_CATEGORIES <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        categories = PRE_DEFINE_CATEGORIES</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        categories = get_categories(xml_files)</span><br><span class="line">    bnd_id = START_BOUNDING_BOX_ID</span><br><span class="line">    startIndex = <span class="number">21800</span> <span class="comment"># 修改这个很重要！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！！</span></span><br><span class="line">    <span class="keyword">for</span> xml_file <span class="keyword">in</span> xml_files:</span><br><span class="line">        file = <span class="built_in">open</span>(xml_file).read()</span><br><span class="line">        file = file.replace(<span class="string">"&amp;amp;"</span>, <span class="string">"_"</span>)</span><br><span class="line">        file = file.replace(<span class="string">"&amp;"</span>, <span class="string">"_"</span>)</span><br><span class="line">        <span class="comment"># print(file)</span></span><br><span class="line">        tree = ET.ElementTree(ET.fromstring(file))</span><br><span class="line">        root = tree.getroot()  <span class="comment"># 获取根节点</span></span><br><span class="line">        <span class="comment"># tree = ET.parse(xml_file)</span></span><br><span class="line">        <span class="comment"># root = tree.getroot()</span></span><br><span class="line">        path = get(root, <span class="string">"path"</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(path) == <span class="number">1</span>:</span><br><span class="line">            filename = os.path.basename(path[<span class="number">0</span>].text)</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">len</span>(path) == <span class="number">0</span>:</span><br><span class="line">            filename = get_and_check(root, <span class="string">"filename"</span>, <span class="number">1</span>).text</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">"%d paths found in %s"</span> % (<span class="built_in">len</span>(path), xml_file))</span><br><span class="line">        <span class="comment">## The filename must be a number</span></span><br><span class="line">        image_id = startIndex</span><br><span class="line">        startIndex += <span class="number">1</span></span><br><span class="line">        size = get_and_check(root, <span class="string">"size"</span>, <span class="number">1</span>)</span><br><span class="line">        width = <span class="built_in">int</span>(get_and_check(size, <span class="string">"width"</span>, <span class="number">1</span>).text)</span><br><span class="line">        height = <span class="built_in">int</span>(get_and_check(size, <span class="string">"height"</span>, <span class="number">1</span>).text)</span><br><span class="line">        image = {</span><br><span class="line">            <span class="string">"file_name"</span>: filename,</span><br><span class="line">            <span class="string">"height"</span>: height,</span><br><span class="line">            <span class="string">"width"</span>: width,</span><br><span class="line">            <span class="string">"id"</span>: image_id,</span><br><span class="line">        }</span><br><span class="line">        json_dict[<span class="string">"images"</span>].append(image)</span><br><span class="line">        <span class="comment">## Currently we do not support segmentation.</span></span><br><span class="line">        <span class="comment">#  segmented = get_and_check(root, 'segmented', 1).text</span></span><br><span class="line">        <span class="comment">#  assert segmented == '0'</span></span><br><span class="line">        <span class="keyword">for</span> obj <span class="keyword">in</span> get(root, <span class="string">"object"</span>):</span><br><span class="line">            category = get_and_check(obj, <span class="string">"name"</span>, <span class="number">1</span>).text</span><br><span class="line">            <span class="keyword">if</span> category <span class="keyword">not</span> <span class="keyword">in</span> categories:</span><br><span class="line">                new_id = <span class="built_in">len</span>(categories)</span><br><span class="line">                categories[category] = new_id</span><br><span class="line">            category_id = categories[category]</span><br><span class="line">            bndbox = get_and_check(obj, <span class="string">"bndbox"</span>, <span class="number">1</span>)</span><br><span class="line">            xmin = <span class="built_in">int</span>(get_and_check(bndbox, <span class="string">"xmin"</span>, <span class="number">1</span>).text) - <span class="number">1</span></span><br><span class="line">            ymin = <span class="built_in">int</span>(get_and_check(bndbox, <span class="string">"ymin"</span>, <span class="number">1</span>).text) - <span class="number">1</span></span><br><span class="line">            xmax = <span class="built_in">int</span>(get_and_check(bndbox, <span class="string">"xmax"</span>, <span class="number">1</span>).text)</span><br><span class="line">            ymax = <span class="built_in">int</span>(get_and_check(bndbox, <span class="string">"ymax"</span>, <span class="number">1</span>).text)</span><br><span class="line">            <span class="keyword">assert</span> xmax &gt; xmin</span><br><span class="line">            <span class="keyword">assert</span> ymax &gt; ymin</span><br><span class="line">            o_width = <span class="built_in">abs</span>(xmax - xmin)</span><br><span class="line">            o_height = <span class="built_in">abs</span>(ymax - ymin)</span><br><span class="line">            ann = {</span><br><span class="line">                <span class="string">"area"</span>: o_width * o_height,</span><br><span class="line">                <span class="string">"iscrowd"</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">"image_id"</span>: image_id,</span><br><span class="line">                <span class="string">"bbox"</span>: [xmin, ymin, o_width, o_height],</span><br><span class="line">                <span class="string">"category_id"</span>: category_id,</span><br><span class="line">                <span class="string">"id"</span>: bnd_id,</span><br><span class="line">                <span class="string">"ignore"</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">"segmentation"</span>: [],</span><br><span class="line">            }</span><br><span class="line">            json_dict[<span class="string">"annotations"</span>].append(ann)</span><br><span class="line">            bnd_id = bnd_id + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> cate, cid <span class="keyword">in</span> categories.items():</span><br><span class="line">        cat = {<span class="string">"supercategory"</span>: <span class="string">"none"</span>, <span class="string">"id"</span>: cid, <span class="string">"name"</span>: cate}</span><br><span class="line">        json_dict[<span class="string">"categories"</span>].append(cat)</span><br><span class="line"></span><br><span class="line">    os.makedirs(os.path.dirname(json_file), exist_ok=<span class="literal">True</span>)</span><br><span class="line">    json_fp = <span class="built_in">open</span>(json_file, <span class="string">"w"</span>)</span><br><span class="line">    json_str = json.dumps(json_dict)</span><br><span class="line">    json_fp.write(json_str)</span><br><span class="line">    json_fp.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xml_val_files = glob.glob(os.path.join(xml_val, <span class="string">"*.xml"</span>))</span><br><span class="line">xml_test_files = glob.glob(os.path.join(xml_test, <span class="string">"*.xml"</span>))</span><br><span class="line">xml_train_files = glob.glob(os.path.join(xml_train, <span class="string">"*.xml"</span>))</span><br><span class="line"></span><br><span class="line">convert(xml_val_files, coco_json_annotations + <span class="string">'val2017.json'</span>)</span><br><span class="line">convert(xml_test_files, coco_json_annotations+<span class="string">'test2017.json'</span>)</span><br><span class="line">convert(xml_train_files, coco_json_annotations + <span class="string">'train2017.json'</span>)</span><br></pre></td></tr></table></figure>

<h3 id="coco2yolo-py「U神GitHub链接」"><a href="#coco2yolo-py「U神GitHub链接」" class="headerlink" title="coco2yolo.py「U神GitHub链接」"></a>coco2yolo.py「<a target="_blank" rel="noopener" href="https://github.com/ultralytics/JSON2YOLO">U神GitHub链接</a>」</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> utils <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert INFOLKS JSON file into YOLO-format labels ----------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_infolks_json</span>(<span class="params">name, files, img_path</span>):</span><br><span class="line">    <span class="comment"># Create folders</span></span><br><span class="line">    path = make_dirs()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Import json</span></span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> glob.glob(files):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file) <span class="keyword">as</span> f:</span><br><span class="line">            jdata = json.load(f)</span><br><span class="line">            jdata[<span class="string">'json_file'</span>] = file</span><br><span class="line">            data.append(jdata)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Write images and shapes</span></span><br><span class="line">    name = path + os.sep + name</span><br><span class="line">    file_id, file_name, wh, cat = [], [], [], []</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> tqdm(data, desc=<span class="string">'Files and Shapes'</span>):</span><br><span class="line">        f = glob.glob(img_path + Path(x[<span class="string">'json_file'</span>]).stem + <span class="string">'.*'</span>)[<span class="number">0</span>]</span><br><span class="line">        file_name.append(f)</span><br><span class="line">        wh.append(exif_size(Image.<span class="built_in">open</span>(f)))  <span class="comment"># (width, height)</span></span><br><span class="line">        cat.extend(a[<span class="string">'classTitle'</span>].lower() <span class="keyword">for</span> a <span class="keyword">in</span> x[<span class="string">'output'</span>][<span class="string">'objects'</span>])  <span class="comment"># categories</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># filename</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(name + <span class="string">'.txt'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> file:</span><br><span class="line">            file.write(<span class="string">'%s\n'</span> % f)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Write *.names file</span></span><br><span class="line">    names = <span class="built_in">sorted</span>(np.unique(cat))</span><br><span class="line">    <span class="comment"># names.pop(names.index('Missing product'))  # remove</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name + <span class="string">'.names'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        [file.write(<span class="string">'%s\n'</span> % a) <span class="keyword">for</span> a <span class="keyword">in</span> names]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Write labels file</span></span><br><span class="line">    <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(data, desc=<span class="string">'Annotations'</span>)):</span><br><span class="line">        label_name = Path(file_name[i]).stem + <span class="string">'.txt'</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(path + <span class="string">'/labels/'</span> + label_name, <span class="string">'a'</span>) <span class="keyword">as</span> file:</span><br><span class="line">            <span class="keyword">for</span> a <span class="keyword">in</span> x[<span class="string">'output'</span>][<span class="string">'objects'</span>]:</span><br><span class="line">                <span class="comment"># if a['classTitle'] == 'Missing product':</span></span><br><span class="line">                <span class="comment">#    continue  # skip</span></span><br><span class="line"></span><br><span class="line">                category_id = names.index(a[<span class="string">'classTitle'</span>].lower())</span><br><span class="line"></span><br><span class="line">                <span class="comment"># The INFOLKS bounding box format is [x-min, y-min, x-max, y-max]</span></span><br><span class="line">                box = np.array(a[<span class="string">'points'</span>][<span class="string">'exterior'</span>], dtype=np.float32).ravel()</span><br><span class="line">                box[[<span class="number">0</span>, <span class="number">2</span>]] /= wh[i][<span class="number">0</span>]  <span class="comment"># normalize x by width</span></span><br><span class="line">                box[[<span class="number">1</span>, <span class="number">3</span>]] /= wh[i][<span class="number">1</span>]  <span class="comment"># normalize y by height</span></span><br><span class="line">                box = [box[[<span class="number">0</span>, <span class="number">2</span>]].mean(), box[[<span class="number">1</span>, <span class="number">3</span>]].mean(), box[<span class="number">2</span>] - box[<span class="number">0</span>], box[<span class="number">3</span>] - box[<span class="number">1</span>]]  <span class="comment"># xywh</span></span><br><span class="line">                <span class="keyword">if</span> (box[<span class="number">2</span>] &gt; <span class="number">0.</span>) <span class="keyword">and</span> (box[<span class="number">3</span>] &gt; <span class="number">0.</span>):  <span class="comment"># if w &gt; 0 and h &gt; 0</span></span><br><span class="line">                    file.write(<span class="string">'%g %.6f %.6f %.6f %.6f\n'</span> % (category_id, *box))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Split data into train, test, and validate files</span></span><br><span class="line">    split_files(name, file_name)</span><br><span class="line">    write_data_data(name + <span class="string">'.data'</span>, nc=<span class="built_in">len</span>(names))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Done. Output saved to <span class="subst">{os.getcwd() + os.sep + path}</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert vott JSON file into YOLO-format labels -------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_vott_json</span>(<span class="params">name, files, img_path</span>):</span><br><span class="line">    <span class="comment"># Create folders</span></span><br><span class="line">    path = make_dirs()</span><br><span class="line">    name = path + os.sep + name</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Import json</span></span><br><span class="line">    data = []</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> glob.glob(files):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file) <span class="keyword">as</span> f:</span><br><span class="line">            jdata = json.load(f)</span><br><span class="line">            jdata[<span class="string">'json_file'</span>] = file</span><br><span class="line">            data.append(jdata)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Get all categories</span></span><br><span class="line">    file_name, wh, cat = [], [], []</span><br><span class="line">    <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(data, desc=<span class="string">'Files and Shapes'</span>)):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            cat.extend(a[<span class="string">'tags'</span>][<span class="number">0</span>] <span class="keyword">for</span> a <span class="keyword">in</span> x[<span class="string">'regions'</span>])  <span class="comment"># categories</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Write *.names file</span></span><br><span class="line">    names = <span class="built_in">sorted</span>(pd.unique(cat))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(name + <span class="string">'.names'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> file:</span><br><span class="line">        [file.write(<span class="string">'%s\n'</span> % a) <span class="keyword">for</span> a <span class="keyword">in</span> names]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Write labels file</span></span><br><span class="line">    n1, n2 = <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    missing_images = []</span><br><span class="line">    <span class="keyword">for</span> i, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(data, desc=<span class="string">'Annotations'</span>)):</span><br><span class="line"></span><br><span class="line">        f = glob.glob(img_path + x[<span class="string">'asset'</span>][<span class="string">'name'</span>] + <span class="string">'.jpg'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(f):</span><br><span class="line">            f = f[<span class="number">0</span>]</span><br><span class="line">            file_name.append(f)</span><br><span class="line">            wh = exif_size(Image.<span class="built_in">open</span>(f))  <span class="comment"># (width, height)</span></span><br><span class="line"></span><br><span class="line">            n1 += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">len</span>(f) &gt; <span class="number">0</span>) <span class="keyword">and</span> (wh[<span class="number">0</span>] &gt; <span class="number">0</span>) <span class="keyword">and</span> (wh[<span class="number">1</span>] &gt; <span class="number">0</span>):</span><br><span class="line">                n2 += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># append filename to list</span></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(name + <span class="string">'.txt'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> file:</span><br><span class="line">                    file.write(<span class="string">'%s\n'</span> % f)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># write labelsfile</span></span><br><span class="line">                label_name = Path(f).stem + <span class="string">'.txt'</span></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>(path + <span class="string">'/labels/'</span> + label_name, <span class="string">'a'</span>) <span class="keyword">as</span> file:</span><br><span class="line">                    <span class="keyword">for</span> a <span class="keyword">in</span> x[<span class="string">'regions'</span>]:</span><br><span class="line">                        category_id = names.index(a[<span class="string">'tags'</span>][<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">                        <span class="comment"># The INFOLKS bounding box format is [x-min, y-min, x-max, y-max]</span></span><br><span class="line">                        box = a[<span class="string">'boundingBox'</span>]</span><br><span class="line">                        box = np.array([box[<span class="string">'left'</span>], box[<span class="string">'top'</span>], box[<span class="string">'width'</span>], box[<span class="string">'height'</span>]]).ravel()</span><br><span class="line">                        box[[<span class="number">0</span>, <span class="number">2</span>]] /= wh[<span class="number">0</span>]  <span class="comment"># normalize x by width</span></span><br><span class="line">                        box[[<span class="number">1</span>, <span class="number">3</span>]] /= wh[<span class="number">1</span>]  <span class="comment"># normalize y by height</span></span><br><span class="line">                        box = [box[<span class="number">0</span>] + box[<span class="number">2</span>] / <span class="number">2</span>, box[<span class="number">1</span>] + box[<span class="number">3</span>] / <span class="number">2</span>, box[<span class="number">2</span>], box[<span class="number">3</span>]]  <span class="comment"># xywh</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (box[<span class="number">2</span>] &gt; <span class="number">0.</span>) <span class="keyword">and</span> (box[<span class="number">3</span>] &gt; <span class="number">0.</span>):  <span class="comment"># if w &gt; 0 and h &gt; 0</span></span><br><span class="line">                            file.write(<span class="string">'%g %.6f %.6f %.6f %.6f\n'</span> % (category_id, *box))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            missing_images.append(x[<span class="string">'asset'</span>][<span class="string">'name'</span>])</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'Attempted %g json imports, found %g images, imported %g annotations successfully'</span> % (i, n1, n2))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(missing_images):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'WARNING, missing images:'</span>, missing_images)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Split data into train, test, and validate files</span></span><br><span class="line">    split_files(name, file_name)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Done. Output saved to <span class="subst">{os.getcwd() + os.sep + path}</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Convert ath JSON file into YOLO-format labels --------------------------------</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_ath_json</span>(<span class="params">json_dir</span>):  <span class="comment"># dir contains json annotations and images</span></span><br><span class="line">    <span class="comment"># Create folders</span></span><br><span class="line">    <span class="built_in">dir</span> = make_dirs()  <span class="comment"># output directory</span></span><br><span class="line"></span><br><span class="line">    jsons = []</span><br><span class="line">    <span class="keyword">for</span> dirpath, dirnames, filenames <span class="keyword">in</span> os.walk(json_dir):</span><br><span class="line">        jsons.extend(</span><br><span class="line">            os.path.join(dirpath, filename)</span><br><span class="line">            <span class="keyword">for</span> filename <span class="keyword">in</span> [</span><br><span class="line">                f <span class="keyword">for</span> f <span class="keyword">in</span> filenames <span class="keyword">if</span> f.lower().endswith(<span class="string">'.json'</span>)</span><br><span class="line">            ]</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Import json</span></span><br><span class="line">    n1, n2, n3 = <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span></span><br><span class="line">    missing_images, file_name = [], []</span><br><span class="line">    <span class="keyword">for</span> json_file <span class="keyword">in</span> <span class="built_in">sorted</span>(jsons):</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(json_file) <span class="keyword">as</span> f:</span><br><span class="line">            data = json.load(f)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># # Get classes</span></span><br><span class="line">        <span class="comment"># try:</span></span><br><span class="line">        <span class="comment">#     classes = list(data['_via_attributes']['region']['class']['options'].values())  # classes</span></span><br><span class="line">        <span class="comment"># except:</span></span><br><span class="line">        <span class="comment">#     classes = list(data['_via_attributes']['region']['Class']['options'].values())  # classes</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># # Write *.names file</span></span><br><span class="line">        <span class="comment"># names = pd.unique(classes)  # preserves sort order</span></span><br><span class="line">        <span class="comment"># with open(dir + 'data.names', 'w') as f:</span></span><br><span class="line">        <span class="comment">#     [f.write('%s\n' % a) for a in names]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Write labels file</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> tqdm(data[<span class="string">'_via_img_metadata'</span>].values(), desc=<span class="string">f'Processing <span class="subst">{json_file}</span>'</span>):</span><br><span class="line">            image_file = <span class="built_in">str</span>(Path(json_file).parent / x[<span class="string">'filename'</span>])</span><br><span class="line">            f = glob.glob(image_file)  <span class="comment"># image file</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(f):</span><br><span class="line">                f = f[<span class="number">0</span>]</span><br><span class="line">                file_name.append(f)</span><br><span class="line">                wh = exif_size(Image.<span class="built_in">open</span>(f))  <span class="comment"># (width, height)</span></span><br><span class="line"></span><br><span class="line">                n1 += <span class="number">1</span>  <span class="comment"># all images</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(f) &gt; <span class="number">0</span> <span class="keyword">and</span> wh[<span class="number">0</span>] &gt; <span class="number">0</span> <span class="keyword">and</span> wh[<span class="number">1</span>] &gt; <span class="number">0</span>:</span><br><span class="line">                    label_file = <span class="built_in">dir</span> + <span class="string">'labels/'</span> + Path(f).stem + <span class="string">'.txt'</span></span><br><span class="line"></span><br><span class="line">                    nlabels = <span class="number">0</span></span><br><span class="line">                    <span class="keyword">try</span>:</span><br><span class="line">                        <span class="keyword">with</span> <span class="built_in">open</span>(label_file, <span class="string">'a'</span>) <span class="keyword">as</span> file:  <span class="comment"># write labelsfile</span></span><br><span class="line">                            <span class="comment"># try:</span></span><br><span class="line">                            <span class="comment">#     category_id = int(a['region_attributes']['class'])</span></span><br><span class="line">                            <span class="comment"># except:</span></span><br><span class="line">                            <span class="comment">#     category_id = int(a['region_attributes']['Class'])</span></span><br><span class="line">                            category_id = <span class="number">0</span>  <span class="comment"># single-class</span></span><br><span class="line"></span><br><span class="line">                            <span class="keyword">for</span> a <span class="keyword">in</span> x[<span class="string">'regions'</span>]:</span><br><span class="line">                                <span class="comment"># bounding box format is [x-min, y-min, x-max, y-max]</span></span><br><span class="line">                                box = a[<span class="string">'shape_attributes'</span>]</span><br><span class="line">                                box = np.array([box[<span class="string">'x'</span>], box[<span class="string">'y'</span>], box[<span class="string">'width'</span>], box[<span class="string">'height'</span>]],</span><br><span class="line">                                               dtype=np.float32).ravel()</span><br><span class="line">                                box[[<span class="number">0</span>, <span class="number">2</span>]] /= wh[<span class="number">0</span>]  <span class="comment"># normalize x by width</span></span><br><span class="line">                                box[[<span class="number">1</span>, <span class="number">3</span>]] /= wh[<span class="number">1</span>]  <span class="comment"># normalize y by height</span></span><br><span class="line">                                box = [box[<span class="number">0</span>] + box[<span class="number">2</span>] / <span class="number">2</span>, box[<span class="number">1</span>] + box[<span class="number">3</span>] / <span class="number">2</span>, box[<span class="number">2</span>],</span><br><span class="line">                                       box[<span class="number">3</span>]]  <span class="comment"># xywh (left-top to center x-y)</span></span><br><span class="line"></span><br><span class="line">                                <span class="keyword">if</span> box[<span class="number">2</span>] &gt; <span class="number">0.</span> <span class="keyword">and</span> box[<span class="number">3</span>] &gt; <span class="number">0.</span>:  <span class="comment"># if w &gt; 0 and h &gt; 0</span></span><br><span class="line">                                    file.write(<span class="string">'%g %.6f %.6f %.6f %.6f\n'</span> % (category_id, *box))</span><br><span class="line">                                    n3 += <span class="number">1</span></span><br><span class="line">                                    nlabels += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> nlabels == <span class="number">0</span>:  <span class="comment"># remove non-labelled images from dataset</span></span><br><span class="line">                            os.system(<span class="string">f'rm <span class="subst">{label_file}</span>'</span>)</span><br><span class="line">                            <span class="comment"># print('no labels for %s' % f)</span></span><br><span class="line">                            <span class="keyword">continue</span>  <span class="comment"># next file</span></span><br><span class="line"></span><br><span class="line">                        <span class="comment"># write image</span></span><br><span class="line">                        img_size = <span class="number">4096</span>  <span class="comment"># resize to maximum</span></span><br><span class="line">                        img = cv2.imread(f)  <span class="comment"># BGR</span></span><br><span class="line">                        <span class="keyword">assert</span> img <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>, <span class="string">'Image Not Found '</span> + f</span><br><span class="line">                        r = img_size / <span class="built_in">max</span>(img.shape)  <span class="comment"># size ratio</span></span><br><span class="line">                        <span class="keyword">if</span> r &lt; <span class="number">1</span>:  <span class="comment"># downsize if necessary</span></span><br><span class="line">                            h, w, _ = img.shape</span><br><span class="line">                            img = cv2.resize(img, (<span class="built_in">int</span>(w * r), <span class="built_in">int</span>(h * r)), interpolation=cv2.INTER_AREA)</span><br><span class="line"></span><br><span class="line">                        ifile = <span class="built_in">dir</span> + <span class="string">'images/'</span> + Path(f).name</span><br><span class="line">                        <span class="keyword">if</span> cv2.imwrite(ifile, img):  <span class="comment"># if success append image to list</span></span><br><span class="line">                            <span class="keyword">with</span> <span class="built_in">open</span>(<span class="built_in">dir</span> + <span class="string">'data.txt'</span>, <span class="string">'a'</span>) <span class="keyword">as</span> file:</span><br><span class="line">                                file.write(<span class="string">'%s\n'</span> % ifile)</span><br><span class="line">                            n2 += <span class="number">1</span>  <span class="comment"># correct images</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">except</span>:</span><br><span class="line">                        os.system(<span class="string">f'rm <span class="subst">{label_file}</span>'</span>)</span><br><span class="line">                        <span class="built_in">print</span>(<span class="string">f'problem with <span class="subst">{f}</span>'</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                missing_images.append(image_file)</span><br><span class="line"></span><br><span class="line">    nm = <span class="built_in">len</span>(missing_images)  <span class="comment"># number missing</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">'\nFound %g JSONs with %g labels over %g images. Found %g images, labelled %g images successfully'</span> %</span><br><span class="line">          (<span class="built_in">len</span>(jsons), n3, n1, n1 - nm, n2))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(missing_images):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">'WARNING, missing images:'</span>, missing_images)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Write *.names file</span></span><br><span class="line">    names = [<span class="string">'knife'</span>]  <span class="comment"># preserves sort order</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="built_in">dir</span> + <span class="string">'data.names'</span>, <span class="string">'w'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        [f.write(<span class="string">'%s\n'</span> % a) <span class="keyword">for</span> a <span class="keyword">in</span> names]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Split data into train, test, and validate files</span></span><br><span class="line">    split_rows_simple(<span class="built_in">dir</span> + <span class="string">'data.txt'</span>)</span><br><span class="line">    write_data_data(<span class="built_in">dir</span> + <span class="string">'data.data'</span>, nc=<span class="number">1</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f'Done. Output saved to <span class="subst">{Path(<span class="built_in">dir</span>).absolute()}</span>'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_coco_json</span>(<span class="params">json_dir=<span class="string">'../coco/annotations/'</span>, use_segments=<span class="literal">False</span>, cls91to80=<span class="literal">False</span></span>):</span><br><span class="line">    save_dir = make_dirs()  <span class="comment"># output directory</span></span><br><span class="line">    coco80 = coco91_to_coco80_class()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Import json</span></span><br><span class="line">    <span class="keyword">for</span> json_file <span class="keyword">in</span> <span class="built_in">sorted</span>(Path(json_dir).resolve().glob(<span class="string">'*.json'</span>)):</span><br><span class="line">        fn = Path(save_dir) / <span class="string">'labels'</span> / json_file.stem.replace(<span class="string">'instances_'</span>, <span class="string">''</span>)  <span class="comment"># folder name</span></span><br><span class="line">        fn.mkdir()</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(json_file) <span class="keyword">as</span> f:</span><br><span class="line">            data = json.load(f)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Create image dict</span></span><br><span class="line">        images = {<span class="string">'%g'</span> % x[<span class="string">'id'</span>]: x <span class="keyword">for</span> x <span class="keyword">in</span> data[<span class="string">'images'</span>]}</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Write labels file</span></span><br><span class="line">        <span class="keyword">for</span> x <span class="keyword">in</span> tqdm(data[<span class="string">'annotations'</span>], desc=<span class="string">f'Annotations <span class="subst">{json_file}</span>'</span>):</span><br><span class="line">            <span class="keyword">if</span> x[<span class="string">'iscrowd'</span>]:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            img = images[<span class="string">'%g'</span> % x[<span class="string">'image_id'</span>]]</span><br><span class="line">            h, w, f = img[<span class="string">'height'</span>], img[<span class="string">'width'</span>], img[<span class="string">'file_name'</span>]</span><br><span class="line"></span><br><span class="line">            <span class="comment"># The COCO box format is [top left x, top left y, width, height]</span></span><br><span class="line">            box = np.array(x[<span class="string">'bbox'</span>], dtype=np.float64)</span><br><span class="line">            box[:<span class="number">2</span>] += box[<span class="number">2</span>:] / <span class="number">2</span>  <span class="comment"># xy top-left corner to center</span></span><br><span class="line">            box[[<span class="number">0</span>, <span class="number">2</span>]] /= w  <span class="comment"># normalize x</span></span><br><span class="line">            box[[<span class="number">1</span>, <span class="number">3</span>]] /= h  <span class="comment"># normalize y</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># Segments</span></span><br><span class="line">            <span class="keyword">if</span> use_segments:</span><br><span class="line">                segments = [j <span class="keyword">for</span> i <span class="keyword">in</span> x[<span class="string">'segmentation'</span>] <span class="keyword">for</span> j <span class="keyword">in</span> i]  <span class="comment"># all segments concatenated</span></span><br><span class="line">                s = (np.array(segments).reshape(-<span class="number">1</span>, <span class="number">2</span>) / np.array([w, h])).reshape(-<span class="number">1</span>).tolist()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Write</span></span><br><span class="line">            <span class="keyword">if</span> box[<span class="number">2</span>] &gt; <span class="number">0</span> <span class="keyword">and</span> box[<span class="number">3</span>] &gt; <span class="number">0</span>:  <span class="comment"># if w &gt; 0 and h &gt; 0</span></span><br><span class="line">                cls = coco80[x[<span class="string">'category_id'</span>] - <span class="number">1</span>] <span class="keyword">if</span> cls91to80 <span class="keyword">else</span> x[<span class="string">'category_id'</span>] - <span class="number">1</span>  <span class="comment"># class</span></span><br><span class="line">                line = cls, *(s <span class="keyword">if</span> use_segments <span class="keyword">else</span> box)  <span class="comment"># cls, box or segments</span></span><br><span class="line">                <span class="keyword">with</span> <span class="built_in">open</span>((fn / f).with_suffix(<span class="string">'.txt'</span>), <span class="string">'a'</span>) <span class="keyword">as</span> file:</span><br><span class="line">                    file.write((<span class="string">'%g '</span> * <span class="built_in">len</span>(line)).rstrip() % line + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    source = <span class="string">'COCO'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> source == <span class="string">'COCO'</span>:</span><br><span class="line">        convert_coco_json(<span class="string">'../../Downloads/Objects365'</span>)  <span class="comment"># directory with *.json</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> source == <span class="string">'infolks'</span>:  <span class="comment"># Infolks https://infolks.info/</span></span><br><span class="line">        convert_infolks_json(name=<span class="string">'out'</span>,</span><br><span class="line">                             files=<span class="string">'../data/sm4/json/*.json'</span>,</span><br><span class="line">                             img_path=<span class="string">'../data/sm4/images/'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> source == <span class="string">'vott'</span>:  <span class="comment"># VoTT https://github.com/microsoft/VoTT</span></span><br><span class="line">        convert_vott_json(name=<span class="string">'data'</span>,</span><br><span class="line">                          files=<span class="string">'../../Downloads/athena_day/20190715/*.json'</span>,</span><br><span class="line">                          img_path=<span class="string">'../../Downloads/athena_day/20190715/'</span>)  <span class="comment"># images folder</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> source == <span class="string">'ath'</span>:  <span class="comment"># ath format</span></span><br><span class="line">        convert_ath_json(json_dir=<span class="string">'../../Downloads/athena/'</span>)  <span class="comment"># images folder</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># zip results</span></span><br><span class="line">    <span class="comment"># os.system('zip -r ../coco.zip ../coco')</span></span><br></pre></td></tr></table></figure>

<h3 id="yolo2coco-py「RapidAI大神GitHub」"><a href="#yolo2coco-py「RapidAI大神GitHub」" class="headerlink" title="yolo2coco.py「RapidAI大神GitHub」"></a>yolo2coco.py「<a target="_blank" rel="noopener" href="https://github.com/RapidAI/YOLO2COCO">RapidAI大神GitHub</a>」</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> shutil</span><br><span class="line"><span class="keyword">from</span> pathlib <span class="keyword">import</span> Path</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_txt</span>(<span class="params">txt_path</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="built_in">str</span>(txt_path), <span class="string">'r'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: x.rstrip(<span class="string">'\n'</span>), f))</span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mkdir</span>(<span class="params">dir_path</span>):</span><br><span class="line">    Path(dir_path).mkdir(parents=<span class="literal">True</span>, exist_ok=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">verify_exists</span>(<span class="params">file_path</span>):</span><br><span class="line">    file_path = Path(file_path)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> file_path.exists():</span><br><span class="line">        <span class="keyword">raise</span> FileNotFoundError(<span class="string">f'The <span class="subst">{file_path}</span> is not exists!!!'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">YOLOV5ToCOCO</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, dir_path</span>):</span><br><span class="line">        self.src_data = Path(dir_path)</span><br><span class="line">        self.src = self.src_data.parent</span><br><span class="line">        self.train_txt_path = self.src_data / <span class="string">'train.txt'</span></span><br><span class="line">        self.val_txt_path = self.src_data / <span class="string">'val.txt'</span></span><br><span class="line">        self.classes_path = self.src_data / <span class="string">'classes.txt'</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 文件存在性校验</span></span><br><span class="line">        verify_exists(self.src_data / <span class="string">'images'</span>)</span><br><span class="line">        verify_exists(self.src_data / <span class="string">'labels'</span>)</span><br><span class="line">        verify_exists(self.train_txt_path)</span><br><span class="line">        verify_exists(self.val_txt_path)</span><br><span class="line">        verify_exists(self.classes_path)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构建COCO格式目录</span></span><br><span class="line">        self.dst = Path(self.src) / <span class="string">f"<span class="subst">{Path(self.src_data).name}</span>_COCO_format"</span></span><br><span class="line">        self.coco_train = <span class="string">"train2017"</span></span><br><span class="line">        self.coco_val = <span class="string">"val2017"</span></span><br><span class="line">        self.coco_annotation = <span class="string">"annotations"</span></span><br><span class="line">        self.coco_train_json = self.dst / self.coco_annotation / \</span><br><span class="line">            <span class="string">f'instances_<span class="subst">{self.coco_train}</span>.json'</span></span><br><span class="line">        self.coco_val_json = self.dst / self.coco_annotation / \</span><br><span class="line">            <span class="string">f'instances_<span class="subst">{self.coco_val}</span>.json'</span></span><br><span class="line"></span><br><span class="line">        mkdir(self.dst)</span><br><span class="line">        mkdir(self.dst / self.coco_train)</span><br><span class="line">        mkdir(self.dst / self.coco_val)</span><br><span class="line">        mkdir(self.dst / self.coco_annotation)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 构建json内容结构</span></span><br><span class="line">        self.<span class="built_in">type</span> = <span class="string">'instances'</span></span><br><span class="line">        self.categories = []</span><br><span class="line">        self.annotation_id = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 读取类别数</span></span><br><span class="line">        self._get_category()</span><br><span class="line"></span><br><span class="line">        cur_year = time.strftime(<span class="string">'%Y'</span>, time.localtime(time.time()))</span><br><span class="line">        self.info = {</span><br><span class="line">            <span class="string">'year'</span>: <span class="built_in">int</span>(cur_year),</span><br><span class="line">            <span class="string">'version'</span>: <span class="string">'1.0'</span>,</span><br><span class="line">            <span class="string">'description'</span>: <span class="string">'For object detection'</span>,</span><br><span class="line">            <span class="string">'date_created'</span>: cur_year,</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        self.licenses = [{</span><br><span class="line">            <span class="string">'id'</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">'name'</span>: <span class="string">'Apache License v2.0'</span>,</span><br><span class="line">            <span class="string">'url'</span>: <span class="string">'https://github.com/RapidAI/YOLO2COCO/LICENSE'</span>,</span><br><span class="line">        }]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_category</span>(<span class="params">self</span>):</span><br><span class="line">        class_list = read_txt(self.classes_path)</span><br><span class="line">        <span class="keyword">for</span> i, category <span class="keyword">in</span> <span class="built_in">enumerate</span>(class_list, <span class="number">1</span>):</span><br><span class="line">            self.categories.append({</span><br><span class="line">                <span class="string">'supercategory'</span>: category,</span><br><span class="line">                <span class="string">'id'</span>: i,</span><br><span class="line">                <span class="string">'name'</span>: category,</span><br><span class="line">            })</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">generate</span>(<span class="params">self</span>):</span><br><span class="line">        self.train_files = read_txt(self.train_txt_path)</span><br><span class="line">        self.valid_files = read_txt(self.val_txt_path)</span><br><span class="line"></span><br><span class="line">        train_dest_dir = Path(self.dst) / self.coco_train</span><br><span class="line">        self.gen_dataset(self.train_files, train_dest_dir,</span><br><span class="line">                         self.coco_train_json, mode=<span class="string">'train'</span>)</span><br><span class="line"></span><br><span class="line">        val_dest_dir = Path(self.dst) / self.coco_val</span><br><span class="line">        self.gen_dataset(self.valid_files, val_dest_dir,</span><br><span class="line">                         self.coco_val_json, mode=<span class="string">'val'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f"The output directory is: <span class="subst">{<span class="built_in">str</span>(self.dst)}</span>"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">gen_dataset</span>(<span class="params">self, img_paths, target_img_path, target_json, mode</span>):</span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        https://cocodataset.org/#format-data</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        images = []</span><br><span class="line">        annotations = []</span><br><span class="line">        <span class="keyword">for</span> img_id, img_path <span class="keyword">in</span> <span class="built_in">enumerate</span>(tqdm(img_paths, desc=mode), <span class="number">1</span>):</span><br><span class="line">            img_path = Path(img_path)</span><br><span class="line"></span><br><span class="line">            verify_exists(img_path)</span><br><span class="line"></span><br><span class="line">            label_path = <span class="built_in">str</span>(img_path.parent.parent</span><br><span class="line">                             / <span class="string">'labels'</span> / <span class="string">f'<span class="subst">{img_path.stem}</span>.txt'</span>)</span><br><span class="line"></span><br><span class="line">            imgsrc = cv2.imread(<span class="built_in">str</span>(img_path))</span><br><span class="line">            height, width = imgsrc.shape[:<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">            dest_file_name = <span class="string">f'<span class="subst">{img_id:012d}</span>.jpg'</span></span><br><span class="line">            save_img_path = target_img_path / dest_file_name</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> img_path.suffix.lower() == <span class="string">".jpg"</span>:</span><br><span class="line">                shutil.copyfile(img_path, save_img_path)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                cv2.imwrite(<span class="built_in">str</span>(save_img_path), imgsrc)</span><br><span class="line"></span><br><span class="line">            images.append({</span><br><span class="line">                <span class="string">'date_captured'</span>: <span class="string">'2021'</span>,</span><br><span class="line">                <span class="string">'file_name'</span>: dest_file_name,</span><br><span class="line">                <span class="string">'id'</span>: img_id,</span><br><span class="line">                <span class="string">'height'</span>: height,</span><br><span class="line">                <span class="string">'width'</span>: width,</span><br><span class="line">            })</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> Path(label_path).exists():</span><br><span class="line">                new_anno = self.read_annotation(label_path, img_id,</span><br><span class="line">                                                height, width)</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(new_anno) &gt; <span class="number">0</span>:</span><br><span class="line">                    annotations.extend(new_anno)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">raise</span> ValueError(<span class="string">f'<span class="subst">{label_path}</span> is empty'</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> FileNotFoundError(<span class="string">f'<span class="subst">{label_path}</span> not exists'</span>)</span><br><span class="line"></span><br><span class="line">        json_data = {</span><br><span class="line">            <span class="string">'info'</span>: self.info,</span><br><span class="line">            <span class="string">'images'</span>: images,</span><br><span class="line">            <span class="string">'licenses'</span>: self.licenses,</span><br><span class="line">            <span class="string">'type'</span>: self.<span class="built_in">type</span>,</span><br><span class="line">            <span class="string">'annotations'</span>: annotations,</span><br><span class="line">            <span class="string">'categories'</span>: self.categories,</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(target_json, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            json.dump(json_data, f, ensure_ascii=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">read_annotation</span>(<span class="params">self, txt_file, img_id, height, width</span>):</span><br><span class="line">        annotation = []</span><br><span class="line">        all_info = read_txt(txt_file)</span><br><span class="line">        <span class="keyword">for</span> label_info <span class="keyword">in</span> all_info:</span><br><span class="line">            <span class="comment"># 遍历一张图中不同标注对象</span></span><br><span class="line">            label_info = label_info.split(<span class="string">" "</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(label_info) &lt; <span class="number">5</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            category_id, vertex_info = label_info[<span class="number">0</span>], label_info[<span class="number">1</span>:]</span><br><span class="line">            segmentation, bbox, area = self._get_annotation(vertex_info,</span><br><span class="line">                                                            height, width)</span><br><span class="line">            annotation.append({</span><br><span class="line">                <span class="string">'segmentation'</span>: segmentation,</span><br><span class="line">                <span class="string">'area'</span>: area,</span><br><span class="line">                <span class="string">'iscrowd'</span>: <span class="number">0</span>,</span><br><span class="line">                <span class="string">'image_id'</span>: img_id,</span><br><span class="line">                <span class="string">'bbox'</span>: bbox,</span><br><span class="line">                <span class="string">'category_id'</span>: <span class="built_in">int</span>(category_id)+<span class="number">1</span>,</span><br><span class="line">                <span class="string">'id'</span>: self.annotation_id,</span><br><span class="line">            })</span><br><span class="line">            self.annotation_id += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> annotation</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_get_annotation</span>(<span class="params">vertex_info, height, width</span>):</span><br><span class="line">        cx, cy, w, h = [<span class="built_in">float</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> vertex_info]</span><br><span class="line"></span><br><span class="line">        cx = cx * width</span><br><span class="line">        cy = cy * height</span><br><span class="line">        box_w = w * width</span><br><span class="line">        box_h = h * height</span><br><span class="line"></span><br><span class="line">        <span class="comment"># left top</span></span><br><span class="line">        x0 = <span class="built_in">max</span>(cx - box_w / <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line">        y0 = <span class="built_in">max</span>(cy - box_h / <span class="number">2</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># right bottomt</span></span><br><span class="line">        x1 = <span class="built_in">min</span>(x0 + box_w, width)</span><br><span class="line">        y1 = <span class="built_in">min</span>(y0 + box_h, height)</span><br><span class="line"></span><br><span class="line">        segmentation = [[x0, y0, x1, y0, x1, y1, x0, y1]]</span><br><span class="line">        bbox = [x0, y0, box_w, box_h]</span><br><span class="line">        area = box_w * box_h</span><br><span class="line">        <span class="keyword">return</span> segmentation, bbox, area</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(<span class="string">'Datasets converter from YOLOV5 to COCO'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--dir_path'</span>, <span class="built_in">type</span>=<span class="built_in">str</span>,</span><br><span class="line">                        default=<span class="string">'datasets/YOLOV5'</span>,</span><br><span class="line">                        <span class="built_in">help</span>=<span class="string">'Dataset root path'</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    converter = YOLOV5ToCOCO(args.dir_path)</span><br><span class="line">    converter.generate()</span><br></pre></td></tr></table></figure>

<h3 id="voc2yolo-py"><a href="#voc2yolo-py" class="headerlink" title="voc2yolo.py"></a>voc2yolo.py</h3><h4 id="放置位置"><a href="#放置位置" class="headerlink" title="放置位置"></a>放置位置</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VOCdevkit</span><br><span class="line">├── VOC2007</span><br><span class="line">└── VOC2012</span><br><span class="line">└── voc2yolo.py</span><br></pre></td></tr></table></figure>

<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> getcwd</span><br><span class="line"></span><br><span class="line">sets = [<span class="string">'train'</span>, <span class="string">'val'</span>, <span class="string">'test'</span>]</span><br><span class="line">classes = [<span class="string">"hat"</span>, <span class="string">"person"</span>]   <span class="comment"># 改成自己的类别</span></span><br><span class="line">abs_path = os.getcwd()</span><br><span class="line"><span class="built_in">print</span>(abs_path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert</span>(<span class="params">size, box</span>):</span><br><span class="line">    dw = <span class="number">1.</span> / (size[<span class="number">0</span>])</span><br><span class="line">    dh = <span class="number">1.</span> / (size[<span class="number">1</span>])</span><br><span class="line">    x = (box[<span class="number">0</span>] + box[<span class="number">1</span>]) / <span class="number">2.0</span> - <span class="number">1</span></span><br><span class="line">    y = (box[<span class="number">2</span>] + box[<span class="number">3</span>]) / <span class="number">2.0</span> - <span class="number">1</span></span><br><span class="line">    w = box[<span class="number">1</span>] - box[<span class="number">0</span>]</span><br><span class="line">    h = box[<span class="number">3</span>] - box[<span class="number">2</span>]</span><br><span class="line">    x = x * dw</span><br><span class="line">    w = w * dw</span><br><span class="line">    y = y * dh</span><br><span class="line">    h = h * dh</span><br><span class="line">    <span class="keyword">return</span> x, y, w, h</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert_annotation</span>(<span class="params">image_id</span>):</span><br><span class="line">    in_file = <span class="built_in">open</span>(<span class="string">'/root/VOC2012/Annotations/%s.xml'</span> % (image_id), encoding=<span class="string">'UTF-8'</span>)</span><br><span class="line">    out_file = <span class="built_in">open</span>(<span class="string">'/root/VOC2012/labels/%s.txt'</span> % (image_id), <span class="string">'w'</span>)</span><br><span class="line">    tree = ET.parse(in_file)</span><br><span class="line">    root = tree.getroot()</span><br><span class="line">    size = root.find(<span class="string">'size'</span>)</span><br><span class="line">    w = <span class="built_in">int</span>(size.find(<span class="string">'width'</span>).text)</span><br><span class="line">    h = <span class="built_in">int</span>(size.find(<span class="string">'height'</span>).text)</span><br><span class="line">    <span class="keyword">for</span> obj <span class="keyword">in</span> root.<span class="built_in">iter</span>(<span class="string">'object'</span>):</span><br><span class="line">        difficult = obj.find(<span class="string">'difficult'</span>).text</span><br><span class="line">        <span class="comment"># difficult = obj.find('Difficult').text</span></span><br><span class="line">        cls = obj.find(<span class="string">'name'</span>).text</span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">not</span> <span class="keyword">in</span> classes <span class="keyword">or</span> <span class="built_in">int</span>(difficult) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        cls_id = classes.index(cls)</span><br><span class="line">        xmlbox = obj.find(<span class="string">'bndbox'</span>)</span><br><span class="line">        b = (<span class="built_in">float</span>(xmlbox.find(<span class="string">'xmin'</span>).text), <span class="built_in">float</span>(xmlbox.find(<span class="string">'xmax'</span>).text), <span class="built_in">float</span>(xmlbox.find(<span class="string">'ymin'</span>).text),</span><br><span class="line">             <span class="built_in">float</span>(xmlbox.find(<span class="string">'ymax'</span>).text))</span><br><span class="line">        b1, b2, b3, b4 = b</span><br><span class="line">        <span class="comment"># 标注越界修正</span></span><br><span class="line">        <span class="keyword">if</span> b2 &gt; w:</span><br><span class="line">            b2 = w</span><br><span class="line">        <span class="keyword">if</span> b4 &gt; h:</span><br><span class="line">            b4 = h</span><br><span class="line">        b = (b1, b2, b3, b4)</span><br><span class="line">        bb = convert((w, h), b)</span><br><span class="line">        out_file.write(<span class="built_in">str</span>(cls_id) + <span class="string">" "</span> + <span class="string">" "</span>.join([<span class="built_in">str</span>(a) <span class="keyword">for</span> a <span class="keyword">in</span> bb]) + <span class="string">'\n'</span>)</span><br><span class="line"></span><br><span class="line">wd = getcwd()</span><br><span class="line"><span class="keyword">for</span> image_set <span class="keyword">in</span> sets:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">'/root/VOC2012/labels/'</span>):</span><br><span class="line">        os.makedirs(<span class="string">'/root/VOC2012/labels/'</span>)</span><br><span class="line">    image_ids = <span class="built_in">open</span>(<span class="string">'/root/VOC2012/ImageSets/Main/%s.txt'</span> % (image_set)).read().strip().split()</span><br><span class="line">    list_file = <span class="built_in">open</span>(<span class="string">'VOC2012/%s.txt'</span> % (image_set), <span class="string">'w'</span>)</span><br><span class="line">    <span class="keyword">for</span> image_id <span class="keyword">in</span> image_ids:</span><br><span class="line">        list_file.write(abs_path + <span class="string">'/VOC2012/images/%s.jpg\n'</span> % (image_id))</span><br><span class="line">        convert_annotation(image_id)</span><br><span class="line">    list_file.close()</span><br></pre></td></tr></table></figure>

<h3 id="yolo2voc-py"><a href="#yolo2voc-py" class="headerlink" title="yolo2voc.py"></a>yolo2voc.py</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> xml.etree.ElementTree <span class="keyword">as</span> ET</span><br><span class="line"><span class="keyword">from</span> xml.dom.minidom <span class="keyword">import</span> parse</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">vocXMLFormat</span>(<span class="params">filePath, imgName, imgW, imgH, objNames, locs, depth=<span class="number">3</span>, truncated=<span class="number">0</span>, difficult=<span class="number">0</span></span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Generate xml annotation file,eg:</span></span><br><span class="line"><span class="string">        vocXMLFormat("0000.xml", "0001.png", 608, 608, ["person", "TV"], [[24, 32, 156, 145], [124, 76, 472, 384]])</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        filePath:The path of the file saved in the generated xml</span></span><br><span class="line"><span class="string">        imgName:xml file annotates the name of the picture</span></span><br><span class="line"><span class="string">        imgW:</span></span><br><span class="line"><span class="string">        imgH:</span></span><br><span class="line"><span class="string">        objNames:The object contained in the picture, format: ["object label 1", "object label 2"...]</span></span><br><span class="line"><span class="string">        locs:The picture contains the coordinates of the object, format: [[x,y,w,h],[x,y,w,h]...]</span></span><br><span class="line"><span class="string">        depth:</span></span><br><span class="line"><span class="string">        truncated:</span></span><br><span class="line"><span class="string">        difficult:</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">if</span> (objNames == <span class="literal">None</span>) <span class="keyword">or</span> (locs == <span class="literal">None</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">"The objNames or locs is None!!!"</span>)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">with</span> codecs.<span class="built_in">open</span>(filePath, <span class="string">'w'</span>, <span class="string">'utf-8'</span>) <span class="keyword">as</span> xml:</span><br><span class="line">        xml.write(<span class="string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'&lt;annotation&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t&lt;folder&gt;'</span> + <span class="string">'voc format'</span> + <span class="string">'&lt;/folder&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t&lt;filename&gt;'</span> + imgName + <span class="string">'&lt;/filename&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t&lt;path&gt;'</span> + imgName + <span class="string">'&lt;/path&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t&lt;source&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t\t&lt;database&gt;weiz&lt;/database&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t&lt;/source&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t&lt;size&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t\t&lt;width&gt;'</span> + <span class="built_in">str</span>(imgW) + <span class="string">'&lt;/width&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t\t&lt;height&gt;'</span> + <span class="built_in">str</span>(imgH) + <span class="string">'&lt;/height&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t\t&lt;depth&gt;'</span> + <span class="built_in">str</span>(depth) + <span class="string">'&lt;/depth&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t&lt;/size&gt;\n'</span>)</span><br><span class="line">        xml.write(<span class="string">'\t&lt;segmented&gt;0&lt;/segmented&gt;\n'</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> ind, name <span class="keyword">in</span> <span class="built_in">enumerate</span>(objNames):</span><br><span class="line">            xml.write(<span class="string">'\t&lt;object&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t&lt;name&gt;'</span> + name + <span class="string">'&lt;/name&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t&lt;pose&gt;Unspecified&lt;/pose&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t&lt;truncated&gt;'</span> + <span class="built_in">str</span>(truncated) + <span class="string">'&lt;/truncated&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t&lt;difficult&gt;'</span> + <span class="built_in">str</span>(difficult) + <span class="string">'&lt;/difficult&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t&lt;bndbox&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t\t&lt;xmin&gt;'</span> + <span class="built_in">str</span>(locs[ind][<span class="number">0</span>]) + <span class="string">'&lt;/xmin&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t\t&lt;ymin&gt;'</span> + <span class="built_in">str</span>(locs[ind][<span class="number">1</span>]) + <span class="string">'&lt;/ymin&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t\t&lt;xmax&gt;'</span> + <span class="built_in">str</span>(locs[ind][<span class="number">0</span>] + locs[ind][<span class="number">2</span>]) + <span class="string">'&lt;/xmax&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t\t&lt;ymax&gt;'</span> + <span class="built_in">str</span>(locs[ind][<span class="number">1</span>] + locs[ind][<span class="number">3</span>]) + <span class="string">'&lt;/ymax&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t\t&lt;/bndbox&gt;\n'</span>)</span><br><span class="line">            xml.write(<span class="string">'\t&lt;/object&gt;\n'</span>)</span><br><span class="line"> </span><br><span class="line">        xml.write(<span class="string">'&lt;/annotation&gt;'</span>)</span><br><span class="line">    xml.close()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"The {} accomplish!"</span>.<span class="built_in">format</span>(filePath))</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">read_line</span>(<span class="params">file_name</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    read file by line</span></span><br><span class="line"><span class="string">    :param file_name:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    lines = []</span><br><span class="line">    file = <span class="built_in">open</span>(file_name)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> file:</span><br><span class="line">        line = line.strip(<span class="string">'\n'</span>)</span><br><span class="line">        lines.append(line)</span><br><span class="line">    file.close()</span><br><span class="line">    <span class="keyword">return</span> lines</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">showAnnotions</span>(<span class="params">image, locs, labels</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    show annotions</span></span><br><span class="line"><span class="string">    :param locs:</span></span><br><span class="line"><span class="string">    :param labels:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> ind, (x, y, w, h) <span class="keyword">in</span> <span class="built_in">enumerate</span>(locs):</span><br><span class="line">        cv2.rectangle(image, (x, y), (x + w, y + h), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line">        cv2.putText(image, labels[ind], (x, y), cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.6</span>, (<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>), <span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line">    cv2.imshow(<span class="string">"iamge"</span>, image)</span><br><span class="line">    cv2.waitKey(<span class="number">30</span>)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">yolo2voc</span>(<span class="params">txt_path, image_path, save_xml_path, label_path</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        txt_path:</span></span><br><span class="line"><span class="string">        image_path:</span></span><br><span class="line"><span class="string">        save_xml_path:</span></span><br><span class="line"><span class="string">        label_path:</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    txt_list = os.listdir(txt_path)</span><br><span class="line">    label_list = read_line(label_path)</span><br><span class="line">    <span class="keyword">for</span> txt_name <span class="keyword">in</span> txt_list:</span><br><span class="line">        image_name, _ = os.path.splitext(txt_name)</span><br><span class="line">        <span class="keyword">for</span> extension <span class="keyword">in</span> [<span class="string">"png"</span>, <span class="string">"jpg"</span>]:  <span class="comment"># read image</span></span><br><span class="line">            image_name_path = image_name + <span class="string">'.'</span> + extension</span><br><span class="line">            image_name_path = os.path.join(image_path, image_name_path)</span><br><span class="line">            <span class="keyword">if</span> os.path.exists(image_name_path):</span><br><span class="line">                image = cv2.imread(image_name_path)</span><br><span class="line">                image_h, image_w, image_channel = image.shape</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"> </span><br><span class="line">        txt_name_path = os.path.join(txt_path, txt_name)</span><br><span class="line">        lines = read_line(txt_name_path)</span><br><span class="line">        object_locs = []</span><br><span class="line">        object_labels = []</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">            ind, center_x, center_y, w, h = line.split(<span class="string">' '</span>)</span><br><span class="line">            x = (<span class="built_in">float</span>(center_x) - <span class="built_in">float</span>(w) / <span class="number">2</span>) * image_w</span><br><span class="line">            y = (<span class="built_in">float</span>(center_y) - <span class="built_in">float</span>(h) / <span class="number">2</span>) * image_h</span><br><span class="line">            w = <span class="built_in">float</span>(w) * image_w</span><br><span class="line">            h = <span class="built_in">float</span>(h) * image_h</span><br><span class="line">            object_locs.append([<span class="built_in">int</span>(x), <span class="built_in">int</span>(y), <span class="built_in">int</span>(w), <span class="built_in">int</span>(h)])</span><br><span class="line">            object_labels.append(label_list[<span class="built_in">int</span>(ind)])</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># showAnnotions(image, object_locs, object_labels)</span></span><br><span class="line">        xml_name_path = os.path.join(save_xml_path, image_name + <span class="string">".xml"</span>)</span><br><span class="line">        vocXMLFormat(xml_name_path, os.path.split(image_name_path)[-<span class="number">1</span>], image_w, image_h, object_labels, object_locs,</span><br><span class="line">                     image_channel)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fractionalSet</span>(<span class="params">imagePath, txtSavePath</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        imagePath:</span></span><br><span class="line"><span class="string">        txtSavePath:</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    testPercent = <span class="number">0.1</span></span><br><span class="line">    valPercent = <span class="number">0.1</span></span><br><span class="line">    trainPercent = <span class="number">0.8</span></span><br><span class="line"> </span><br><span class="line">    imageNames = os.listdir(imagePath)</span><br><span class="line">    testNum = <span class="built_in">int</span>(<span class="built_in">len</span>(imageNames) * testPercent)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"testNum:"</span>, testNum)</span><br><span class="line">    valNum = <span class="built_in">int</span>(<span class="built_in">len</span>(imageNames) * valPercent)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"valNum:"</span>, valNum)</span><br><span class="line">    trainNum = <span class="built_in">len</span>(imageNames) - testNum - valNum</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"trainNum"</span>, trainNum)</span><br><span class="line">    trainValNum = trainNum + valNum</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">"trainValNum:"</span>, trainValNum)</span><br><span class="line"> </span><br><span class="line">    test = random.sample(imageNames, testNum)</span><br><span class="line">    imageNamesTrainVal = <span class="built_in">list</span>(<span class="built_in">set</span>(imageNames) - <span class="built_in">set</span>(test))</span><br><span class="line">    val = random.sample(imageNamesTrainVal, valNum)</span><br><span class="line">    train = <span class="built_in">list</span>(<span class="built_in">set</span>(imageNamesTrainVal) - <span class="built_in">set</span>(val))</span><br><span class="line"> </span><br><span class="line">    ftrainval_path = os.path.join(txtSavePath, <span class="string">"trainval.txt"</span>)</span><br><span class="line">    ftest_path = os.path.join(txtSavePath, <span class="string">"test.txt"</span>)</span><br><span class="line">    ftrain_path = os.path.join(txtSavePath, <span class="string">"train.txt"</span>)</span><br><span class="line">    fval_path = os.path.join(txtSavePath, <span class="string">"val.txt"</span>)</span><br><span class="line"> </span><br><span class="line">    ftrainval = <span class="built_in">open</span>(ftrainval_path, <span class="string">'w'</span>)</span><br><span class="line">    ftest = <span class="built_in">open</span>(ftest_path, <span class="string">'w'</span>)</span><br><span class="line">    ftrain = <span class="built_in">open</span>(ftrain_path, <span class="string">'w'</span>)</span><br><span class="line">    fval = <span class="built_in">open</span>(fval_path, <span class="string">'w'</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">for</span> imageName <span class="keyword">in</span> imageNames:</span><br><span class="line">        <span class="keyword">if</span> imageName <span class="keyword">in</span> test:</span><br><span class="line">            imageName = imageName.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">"\n"</span></span><br><span class="line">            ftest.write(imageName)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> imageName <span class="keyword">in</span> val:</span><br><span class="line">                imageName = imageName.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">"\n"</span></span><br><span class="line">                fval.write(imageName)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                imageName = imageName.split(<span class="string">'.'</span>)[<span class="number">0</span>] + <span class="string">"\n"</span></span><br><span class="line">                ftrain.write(imageName)</span><br><span class="line">            ftrainval.write(imageName)</span><br><span class="line"> </span><br><span class="line">    ftrainval.close()</span><br><span class="line">    ftrain.close()</span><br><span class="line">    fval.close()</span><br><span class="line">    ftest.close()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">convert</span>(<span class="params">size, box</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    ·µ»Ø¹éÒ»»¯ºóµÄÖÐÐÄµã£¬¿í¸ßÖµ</span></span><br><span class="line"><span class="string">    :param size:</span></span><br><span class="line"><span class="string">    :param box:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    dw = <span class="number">1.</span>/(size[<span class="number">0</span>])</span><br><span class="line">    dh = <span class="number">1.</span>/(size[<span class="number">1</span>])</span><br><span class="line">    x = (box[<span class="number">0</span>] + box[<span class="number">1</span>])/<span class="number">2.0</span> - <span class="number">1</span></span><br><span class="line">    y = (box[<span class="number">2</span>] + box[<span class="number">3</span>])/<span class="number">2.0</span> - <span class="number">1</span></span><br><span class="line">    w = box[<span class="number">1</span>] - box[<span class="number">0</span>]</span><br><span class="line">    h = box[<span class="number">3</span>] - box[<span class="number">2</span>]</span><br><span class="line">    x = x*dw</span><br><span class="line">    w = w*dw</span><br><span class="line">    y = y*dh</span><br><span class="line">    h = h*dh</span><br><span class="line">    <span class="keyword">return</span> (x,y,w,h)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">count_label_num</span>(<span class="params">xml_path</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        xml_path:</span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    classes = []</span><br><span class="line">    num = []</span><br><span class="line"> </span><br><span class="line">    xml_list = os.listdir(xml_path)</span><br><span class="line">    <span class="keyword">for</span> xml_name <span class="keyword">in</span> xml_list:</span><br><span class="line">        xml_name_path = os.path.join(xml_path, xml_name)</span><br><span class="line"> </span><br><span class="line">        et = ET.parse(xml_name_path)</span><br><span class="line">        root = et.getroot()</span><br><span class="line">        <span class="keyword">for</span> obj <span class="keyword">in</span> root.<span class="built_in">iter</span>(<span class="string">'object'</span>):</span><br><span class="line">            cls = obj.find(<span class="string">"name"</span>).text</span><br><span class="line"> </span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                cls_id = classes.index(cls)</span><br><span class="line">            <span class="keyword">except</span> ValueError:</span><br><span class="line">                classes.append(cls)</span><br><span class="line">                num.append(<span class="number">0</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">"add new label:{}"</span>.<span class="built_in">format</span>(cls))</span><br><span class="line">                cls_id = classes.index(cls)</span><br><span class="line"> </span><br><span class="line">            num[cls_id] += <span class="number">1</span></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> classes, num</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">checkLabel</span>(<span class="params">imagePath, labelPath</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Ëæ»ú³é²é¼ì²é±ê×¢Êý¾ÝÊÇ·ñÕýÈ·</span></span><br><span class="line"><span class="string">    :param imagePath:</span></span><br><span class="line"><span class="string">    :param labelPath:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    labelNames = os.listdir(labelPath)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        index = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(labelNames) - <span class="number">1</span>)</span><br><span class="line">        labelPath_tmp = os.path.join(labelPath, labelNames[index])</span><br><span class="line"> </span><br><span class="line">        tree = ET.parse(labelPath_tmp)</span><br><span class="line">        root = tree.getroot()</span><br><span class="line">        imageName = root.find(<span class="string">'filename'</span>).text</span><br><span class="line">        labels = []   <span class="comment"># ±êÇ©ÐÅÏ¢[[x,y,w,h,label]]</span></span><br><span class="line">        <span class="keyword">for</span> obj <span class="keyword">in</span> root.<span class="built_in">iter</span>(<span class="string">'object'</span>):</span><br><span class="line">            x1 = <span class="built_in">int</span>(obj.find(<span class="string">"bndbox"</span>).find(<span class="string">"xmin"</span>).text)</span><br><span class="line">            y1 = <span class="built_in">int</span>(obj.find(<span class="string">"bndbox"</span>).find(<span class="string">"ymin"</span>).text)</span><br><span class="line">            x2 = <span class="built_in">int</span>(obj.find(<span class="string">"bndbox"</span>).find(<span class="string">"xmax"</span>).text)</span><br><span class="line">            y2 = <span class="built_in">int</span>(obj.find(<span class="string">"bndbox"</span>).find(<span class="string">"ymax"</span>).text)</span><br><span class="line">            name = obj.find(<span class="string">"name"</span>).text</span><br><span class="line">            labels.append([x1, y1, x2, y2, name])</span><br><span class="line"> </span><br><span class="line">        imagePath_tmp = os.path.join(imagePath, imageName)</span><br><span class="line">        img = cv2.imread(imagePath_tmp)</span><br><span class="line">        <span class="keyword">for</span> label <span class="keyword">in</span> labels:</span><br><span class="line">            cv2.rectangle(img, (label[<span class="number">0</span>], label[<span class="number">1</span>]), (label[<span class="number">2</span>], label[<span class="number">3</span>]), (<span class="number">0</span>, <span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">            cv2.putText(img, label[-<span class="number">1</span>], (label[<span class="number">0</span>], label[<span class="number">1</span>]), cv2.FONT_HERSHEY_SIMPLEX, <span class="number">0.8</span>, (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line">        cv2.imshow(imageName, img)</span><br><span class="line">        k = cv2.waitKey(<span class="number">0</span>)</span><br><span class="line"> </span><br><span class="line">        <span class="comment"># °´Esc¼üÍË³ö</span></span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">27</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># °´ÓÒ¼ýÍ·ºÍÏÂ¼ýÍ·¼ÌÐø¼ì²â</span></span><br><span class="line">        <span class="keyword">if</span> k != <span class="number">1</span> <span class="keyword">and</span> k != <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">if</span> k == <span class="number">27</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            k = cv2.waitKey(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">if</span> k == <span class="number">27</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        cv2.destroyAllWindows()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">txt_path = <span class="string">"/home/zyy/桌面/label"</span></span><br><span class="line">image_path = <span class="string">"./defect4/JPEGImages"</span></span><br><span class="line">save_xml_path = <span class="string">"./defect4/Annotations"</span></span><br><span class="line">image_sets = <span class="string">"./defect4/ImageSets/Main"</span></span><br><span class="line">label_path = <span class="string">"./defect4/label.txt"</span></span><br><span class="line">setNames = [<span class="string">"test.txt"</span>, <span class="string">"val.txt"</span>, <span class="string">"train.txt"</span>, <span class="string">"trainval.txt"</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># yolo2voc(txt_path, image_path, save_xml_path, label_path)</span></span><br><span class="line">    <span class="comment"># fractionalSet(image_path, image_sets)</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># classes, num = count_label_num(save_xml_path)</span></span><br><span class="line">    <span class="comment"># print(classes)</span></span><br><span class="line">    <span class="comment"># print(num)</span></span><br><span class="line"> </span><br><span class="line">    checkLabel(image_path, save_xml_path)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%B0%8F%E8%84%9A%E6%9C%AC/" rel="tag"># 小脚本</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/23/%E3%80%8C%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%9F%BA%E7%A1%80%E3%80%8D%E5%8F%8D%E5%90%91%E4%BC%A0%E6%92%AD/" rel="prev" title="「深度学习基础」反向传播">
                  <i class="fa fa-chevron-left"></i> 「深度学习基础」反向传播
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/05/23/%E3%80%8C%E5%B0%8F%E8%84%9A%E6%9C%AC%E3%80%8D%EF%BC%88%E4%B8%80%EF%BC%89%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E6%95%B0%E6%8D%AE%E6%A0%87%E7%AD%BE%E5%8F%AF%E8%A7%86%E5%8C%96/" rel="next" title="「小脚本」（一）目标检测数据标签可视化">
                  「小脚本」（一）目标检测数据标签可视化 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">陨石kk</span>
</div>

<!--
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>
--!>

    </div>
  </footer>

  
  <script src="https://unpkg.com/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://unpkg.com/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://unpkg.com/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>



  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://unpkg.com/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"log":false});</script></body>
</html>
